<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <style type="text/css">.highlight table td { padding: 5px; }
        .highlight table pre { margin: 0; }
        .highlight .gh {
          color: #999999;
        }
        .highlight .sr {
          color: #f6aa11;
        }
        .highlight .go {
          color: #888888;
        }
        .highlight .gp {
          color: #555555;
        }
        .highlight .gs {
        }
        .highlight .gu {
          color: #aaaaaa;
        }
        .highlight .nb {
          color: #f6aa11;
        }
        .highlight .cm {
          color: #75715e;
        }
        .highlight .cp {
          color: #75715e;
        }
        .highlight .c1 {
          color: #75715e;
        }
        .highlight .cs {
          color: #75715e;
        }
        .highlight .c, .highlight .cd {
          color: #75715e;
        }
        .highlight .err {
          color: #960050;
        }
        .highlight .gr {
          color: #960050;
        }
        .highlight .gt {
          color: #960050;
        }
        .highlight .gd {
          color: #49483e;
        }
        .highlight .gi {
          color: #49483e;
        }
        .highlight .ge {
          color: #49483e;
        }
        .highlight .kc {
          color: #66d9ef;
        }
        .highlight .kd {
          color: #66d9ef;
        }
        .highlight .kr {
          color: #66d9ef;
        }
        .highlight .no {
          color: #66d9ef;
        }
        .highlight .kt {
          color: #66d9ef;
        }
        .highlight .mf {
          color: #ae81ff;
        }
        .highlight .mh {
          color: #ae81ff;
        }
        .highlight .il {
          color: #ae81ff;
        }
        .highlight .mi {
          color: #ae81ff;
        }
        .highlight .mo {
          color: #ae81ff;
        }
        .highlight .m, .highlight .mb, .highlight .mx {
          color: #ae81ff;
        }
        .highlight .sc {
          color: #ae81ff;
        }
        .highlight .se {
          color: #ae81ff;
        }
        .highlight .ss {
          color: #ae81ff;
        }
        .highlight .sd {
          color: #e6db74;
        }
        .highlight .s2 {
          color: #e6db74;
        }
        .highlight .sb {
          color: #e6db74;
        }
        .highlight .sh {
          color: #e6db74;
        }
        .highlight .si {
          color: #e6db74;
        }
        .highlight .sx {
          color: #e6db74;
        }
        .highlight .s1 {
          color: #e6db74;
        }
        .highlight .s {
          color: #e6db74;
        }
        .highlight .na {
          color: #a6e22e;
        }
        .highlight .nc {
          color: #a6e22e;
        }
        .highlight .nd {
          color: #a6e22e;
        }
        .highlight .ne {
          color: #a6e22e;
        }
        .highlight .nf {
          color: #a6e22e;
        }
        .highlight .vc {
          color: #ffffff;
        }
        .highlight .nn {
          color: #ffffff;
        }
        .highlight .nl {
          color: #ffffff;
        }
        .highlight .ni {
          color: #ffffff;
        }
        .highlight .bp {
          color: #ffffff;
        }
        .highlight .vg {
          color: #ffffff;
        }
        .highlight .vi {
          color: #ffffff;
        }
        .highlight .nv {
          color: #ffffff;
        }
        .highlight .w {
          color: #ffffff;
        }
        .highlight {
          color: #ffffff;
        }
        .highlight .n, .highlight .py, .highlight .nx {
          color: #ffffff;
        }
        .highlight .ow {
          color: #f92672;
        }
        .highlight .nt {
          color: #f92672;
        }
        .highlight .k, .highlight .kv {
          color: #f92672;
        }
        .highlight .kn {
          color: #f92672;
        }
        .highlight .kp {
          color: #f92672;
        }
        .highlight .o {
          color: #f92672;
        }
        </style>
        <link href="/styles/css/screen.css" media="screen" rel="stylesheet" />
        <link href="/styles/css/print.css" media="print" rel="stylesheet" />
        <script src="/styles/js/all.js"></script><script>
              document.onreadystatechange = function () {
                   if (document.readyState == "complete") {
        
              var docstype = document.body;
              docstype.classList.add("index");
      
            $('html, body').animate({
                scrollTop: $($('#authentication')).offset().top
              }, 2000);
        
        
              var element = document.getElementById('admin-menu-wrapper');
              if(element!=null){
              //document.getElementById('tocifyme').style.marginTop = '220px';
              }
              }}          
          </script>
    </head>
</head>

        <body>
            <p><a href="#" id="nav-button"><span>NAV <img alt="Navbar" src="/sites/all/themes/apigee_responsive_custom/images/navbar.png" /> </span> </a></p>
            
            <div class="tocify-wrapper" id="tocifyme" style="margin-top: 171px !important;">
            <div class="lang-selector"><a data-language-name="shell" href="#">cUrl</a> <a data-language-name="ruby" href="#">Ruby</a> <a data-language-name="python" href="#">Python</a> <a data-language-name="javascript" href="#">Node JS</a> <a data-language-name="php" href="#">PHP</a> <a data-language-name="clojure" href="#">Clojure</a> <a data-language-name="java" href="#">Java</a> <a data-language-name="json" href="#">Json Response</a></div>
            
            <div class="search"><input class="search" id="input-search" placeholder="Search" type="text" /></div>
            
            <ul class="search-results">
            </ul>
            
            <div id="toc" style="overflow: auto;height: 47%;">&nbsp;</div>
            
            <ul class="toc-footer">
              <li><a href="https://developer.safaricom.co.ke/login-register">&nbsp;Sign Up for an Account</a></li>
              <li><a href="/sites/default/files/cert/cert.cer" target="_blank">&nbsp;M-Pesa Public Key Certificate</a></li>
              <li><a href="/sites/default/files/cert/cert_prod/cert.cer" target="_blank">&nbsp;Production Certificate</a></li>
              <li><a href="/sites/default/files/cert/cert_sandbox/cert.cer" target="_blank">&nbsp;Sandbox Certificate</a></li>
              <li><a href="https://app.getpostman.com/run-collection/b15e9c78a78562cca241"><img src="/sites/all/themes/apigee_responsive_custom/images/postman.ico" />&nbsp;Run in Postman</a></li>
              <li><a href="https://github.com/safaricom"><img src="/sites/default/files/git.svg" />Github</a></li>
            </ul>
            </div>
            
            <div class="page-wrapper" style="margin-top: -25px;">
            <div class="dark-box" style="margin-top:-40px;"></div>
            
            <div class="content">
            <h1 id="introduction">Introduction</h1>
            
            <p>Welcome to Safaricom APIs! In this release, we have exposed API endpoints for accessing M-Pesa services; we have M-Pesa API endpoints for B2B, B2C, and C2B. Our APIs are built on <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST</a>; data entities are represented as HTTP resources and are accessed using HTTP verbs, majorly GET and POST. API request parameters and responses - including errors - are encoded in <a href="http://www.json.org/">JSON</a>. Our APIs response status codes and error codes comply with HTTP status codes as defined in <a href="https://www.ietf.org/rfc/rfc2616.txt">RFC 2616</a>. You can invoke our API endpoints using REST clients like <a href="https://www.getpostman.com">Postman</a> or <a href="https://www.soapui.org">SoapUI</a> and command line tools like <a href="https://curl.haxx.se">cUrl</a> and <a href="https://nodejs.org">Node.js</a>.</p>
            
            <p>To get you started, we have provided code samples in curl, Ruby, PHP, Python, NodeJS, and Java! Sample JSON responses for each APIs request have also been availed. You can view the code examples to the right, and you can switch between the programming languages with the tabs on the top right.</p>
            
            <p><a href="https://app.getpostman.com/run-collection/b15e9c78a78562cca241"><img src="/sites/all/themes/apigee_responsive_custom/images/run_in_postman_btn.svg" /> </a></p>
            
            <h1 id="getting-started">Getting Started</h1>
            
            <h2 id="developer-sign-up">Developer Sign-up</h2>
            
            <p>To use our APIs or invoke an API endpoint, you will need to <a href="https://developer.safaricom.co.ke/login_registration/login-register">register</a> for an account. Available accounts are individual and company accounts. Company accounts are for users with an existing M-PESA shortcodes or billing accounts with Safaricom and wish to test our APIs with an intention to develop a production app; users intending to apply for an M-Pesa shortcode can also register with a company account.</p>
            
            <p>An account activation link will be sent in an email to the email address you used in registering for a developer account; the activation link expires within 24 hours of it being sent, and you will need to register for another account. The account activation link enables you to activate your developer account and set a password for your account.</p>
            
            <h2 id="creating-a-sandbox-app">Creating a Sandbox App</h2>
            
            <p>The first time you log in into your developer account, after account activation, the <a href="https://developer.safaricom.co.ke/user/me/apps">sandbox apps</a> page opens from which you can create an app by clicking</p>
            
            <p><img alt="add an app" src="/sites/all/themes/apigee_responsive_custom/images/add_an_app.png" />.</p>
            
            <p>Creating an app involves setting an app name and choosing the API products for which you will want to use. API products are a business package of the available APIs and the rules for access built around them.</p>
            
            <h2 id="app-dashboard">App Dashboard</h2>
            
            <p>Once you have created an app, a dashboard from which you can view details about the app(s) you have created. Clicking on an app reveals tabs with more information about the app; the tabs are Keys, Products, Details, Edit and Delete.</p>
            
            <h3 id="keys">Keys</h3>
            
            <p>The app keys of an app are the consumer key and consumer secret. The Keys tab shows the app keys, the date they were issued and their expiry period. Sandbox keys do not expire.</p>
            
            <h3 id="products">Products</h3>
            
            <p>A product is an encapsulation of an API(s) with access rules and business rules around their use. The use case of an app the developer is building should be guided by an API product. Access rules involve the traffic generated by the app.</p>
            
            <h3 id="details">Details</h3>
            
            <p>The details tab gives you a summary of the details about your app and the terms and conditions for accessing the sandbox.</p>
            
            <h3 id="analytics">Analytics</h3>
            
            <p>From the analytics tab, you can gauge how you can gauge how your app is performing over a period of time - day, week(s) or month(s). We provide app analytics for throughput, maximum response time, minimum response time, endpoint response time, message count and error count</p>
            
            <h3 id="edit">Edit</h3>
            
            <p>Should you need to change details about your app, like its name or API products, then you can do so in the Edit tab.</p>
            
            <h3 id="delete">Delete</h3>
            
            <p>This delete tab, destroys your app and removes it from your dashboard.</p>
            
            <h1 id="authentication">Authentication</h1>
            
            <blockquote>
            <p>To authenticate your app and get an OAuth access token, use this code. An access token expires in 3600 seconds or 1 hour</p>
            </blockquote>
            
            <pre class="highlight shell tab-shell">
            <code><span class="c"># With cUrl, you can just pass the correct header with each request</span>
            curl -X GET https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type<span class="o">=</span>client_credentials  <span class="se">\</span>
              -H <span class="s2">&quot;Accept: application/json&quot;</span> <span class="se">\</span>
              -u <span class="s2">&quot;YOUR_APP_CONSUMER_KEY:YOUR_APP_CONSUMER_SECRET&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials&#39;</span><span class="p">)</span>
            
            <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span>
              <span class="ss">:use_ssl</span> <span class="o">=&gt;</span> <span class="n">uri</span><span class="p">.</span><span class="nf">scheme</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span>
              <span class="ss">:verify_mode</span> <span class="o">=&gt;</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span><span class="p">)</span>
            
            <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
            
              <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span> <span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span>
              <span class="n">request</span><span class="p">.</span><span class="nf">basic_auth</span> <span class="s1">&#39;YOUR_APP_CONSUMER_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;YOUR_APP_CONSUMER_SECRET&#39;</span>
            
              <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span> <span class="n">request</span> <span class="c1"># Net::HTTPResponse object</span>
            
              <span class="nb">puts</span> <span class="n">response</span>
              <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span>
            <span class="k">end</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            <span class="kn">from</span> <span class="nn">requests.auth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>
            
            <span class="n">consumer_key</span> <span class="o">=</span> <span class="s">&quot;YOUR_APP_CONSUMER_KEY&quot;</span>
            <span class="n">consumer_secret</span> <span class="o">=</span> <span class="s">&quot;YOUR_APP_CONSUMER_SECRET&quot;</span>
            <span class="n">api_URL</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials&quot;</span>
            
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_URL</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">))</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">consumer_key</span> <span class="o">=</span> <span class="s2">&quot;YOUR_APP_CONSUMER_KEY&quot;</span><span class="p">,</span>
              <span class="nx">consumer_secret</span> <span class="o">=</span> <span class="s2">&quot;YOUR_APP_CONSUMER_SECRET&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Basic &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">consumer_key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">consumer_secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;base64&quot;</span><span class="p">);</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract OAuth access token</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nv">$credentials</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="s1">&#39;YOUR_APP_CONSUMER_KEY:YOUR_APP_CONSUMER_SECRET&#39;</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Authorization: Basic &#39;</span><span class="o">.</span><span class="nv">$credentials</span><span class="p">));</span> <span class="c1">//setting a custom header
            </span><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="n">consumer-key</span><span class="w"> </span><span class="s">&quot;YOUR_APP_CONSUMER_KEY&quot;</span><span class="w">
              </span><span class="n">consumer-secret</span><span class="w"> </span><span class="s">&quot;YOUR_APP_CONSUMER_SECRET&quot;</span><span class="w">
              </span><span class="n">endpoint</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials&quot;</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w">
              </span><span class="p">(</span><span class="nf">clj-http.client/get</span><span class="w"> </span><span class="n">endpoint</span><span class="p">{</span><span class="w">
                </span><span class="no">:basic-auth</span><span class="w"> </span><span class="p">[</span><span class="n">consumer-key</span><span class="w"> </span><span class="n">consumer-secret</span><span class="p">]</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">clojure.data.json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="c1">// Use base64 to encode the consumer key and secret.</span>
            <span class="n">String</span> <span class="n">app_key</span> <span class="o">=</span> <span class="s">&quot;YOUR_CONSUMER_KEY&quot;</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">app_secret</span> <span class="o">=</span> <span class="s">&quot;YOUR_CONSUMER_SECRET&quot;</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">appKeySecret</span> <span class="o">=</span> <span class="n">app_key</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">app_secret</span><span class="o">;</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">appKeySecret</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&quot;ISO-8859-1&quot;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">auth</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
            
            <span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">get</span><span class="o">()</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Basic &quot;</span> <span class="o">+</span> <span class="n">auth</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;cache-control&quot;</span><span class="o">,</span> <span class="s">&quot;no-cache&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SGWcJPtNtYNPGm6uSYR9yPYrAI3Bm&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3599&quot;</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>To make an API call, you will need to authenticate your app. We have provided an OAuth API for you to generate an access token, we support client_credentials grant type. To authorize your API call to the OAuth API, you will need a Basic Auth over HTTPS authorization token. The Basic Auth string is a base64 encoded string of your app&rsquo;s client key and client secret. We have provided a means to obtain the Basic Auth string for your sandbox apps; while you are in the <a href="https://developer.safaricom.co.ke/oauth/apis/get/generate-1">OAuth API&rsquo;s sandbox</a>. Click on &lsquo;HTTP Basic Set Credentials&rsquo; button.</p>
            
            <p><img alt="HTTP Basic Set Credentials" src="/sites/all/themes/apigee_responsive_custom/images/set_credentials.png" /></p>
            
            <p>In the pop-up menu that appears, enter your consumer key and consumer secret. You have an option to save these credentials for 30 days and therefore, you do not need to set them every time you need an access token</p>
            
            <p><img alt="Set Credentials Menu" src="/sites/all/themes/apigee_responsive_custom/images/set_credentials_menu.png" /></p>
            
            <aside class="notice">The OAuth access token expires after an hour, after which, you will need to generate another access token. On a production app, use a base64 library of the programming language you are using to build your app to get the Basic Auth string that you will then use to invoke our OAuth API to get an access token.</aside>
            
            <h2 id="http-header-parameters">HTTP Header Parameters</h2>
            
            <p>With an OAuth 2.0 Access Token, an application can now invoke our APIs by including the access token in the HTTP header. Our APIs currently only supports <code class="prettyprint">application/json</code> content type.</p>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Authorization</td>
                  <td>OAuth 2.0 Access Token. Bearer keyword followed by a space and the OAuth 2.0 Access Token. <code class="prettyprint">Bearer &lt;Access-Token&gt;</code></td>
                </tr>
                <tr>
                  <td>Content-Type</td>
                  <td>Only <code class="prettyprint">application/json</code> content type is supported.</td>
                </tr>
              </tbody>
            </table>
            
            <h1 id="security-credentials">Security Credentials</h1>
            
            <pre class="highlight java tab-java">
            <code><span class="c1">// Classes and Libraries to import</span>
            <span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.security.Security</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.security.PublicKey</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.security.cert.CertificateFactory</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.security.cert.X509Certificate</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">com.sun.org.apache.xerces.internal.impl.dv.util.Base64</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.io</span> <span class="n">ByteArrayOutputStream</span><span class="o">;</span>
            
            <span class="c1">// Function to encrypt the initiator credentials</span>
            <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encryptInitiatorPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">securityCertificate</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">encryptedPassword</span> <span class="o">=</span> <span class="s">&quot;YOUR_INITIATOR_PASSWORD&quot;</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">Security</span><span class="o">.</span><span class="na">addProvider</span><span class="o">(</span><span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">bouncycastle</span><span class="o">.</span><span class="na">jce</span><span class="o">.</span><span class="na">provider</span><span class="o">.</span><span class="na">BouncyCastleProvider</span><span class="o">());</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">input</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
            
                    <span class="n">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;RSA/ECB/PKCS1Padding&quot;</span><span class="o">,</span> <span class="s">&quot;BC&quot;</span><span class="o">);</span>
                    <span class="n">FileInputStream</span> <span class="n">fin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">securityCertificate</span><span class="o">));</span>
                    <span class="n">CertificateFactory</span> <span class="n">cf</span> <span class="o">=</span> <span class="n">CertificateFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;X.509&quot;</span><span class="o">);</span>
                    <span class="n">X509Certificate</span> <span class="n">certificate</span> <span class="o">=</span> <span class="o">(</span><span class="n">X509Certificate</span><span class="o">)</span> <span class="n">cf</span><span class="o">.</span><span class="na">generateCertificate</span><span class="o">(</span><span class="n">fin</span><span class="o">);</span>
                    <span class="n">PublicKey</span> <span class="n">pk</span> <span class="o">=</span> <span class="n">certificate</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">();</span>
                    <span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">ENCRYPT_MODE</span><span class="o">,</span> <span class="n">pk</span><span class="o">);</span>
            
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">cipherText</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
            
                    <span class="c1">// Convert the resulting encrypted byte array into a string using base64 encoding</span>
                    <span class="n">encryptedPassword</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">cipherText</span><span class="o">);</span>
            
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchAlgorithmException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchProviderException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchPaddingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">CertificateException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InvalidKeyException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalBlockSizeException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BadPaddingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">PasswordUtil</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="o">}</span>
            
                <span class="k">return</span> <span class="n">encryptedPassword</span><span class="o">;</span>
            <span class="o">}</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code>
            <span class="kd">var</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;crypto&quot;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">constants</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;constants&quot;</span><span class="p">);</span>
            
            <span class="c1">// CAUTION: This is a 512 bit RSA demo key - NEVER USE THIS SOMEWHERE FOR REAL!</span>
            <span class="kd">var</span> <span class="nx">privatekey</span> <span class="o">=</span> <span class="s2">&quot;PATH_TO_CERTIFICATE_FILE&quot;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">bufferToEncrypt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">publicEncrypt</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="p">:</span> <span class="nx">privatekey</span><span class="p">,</span> <span class="na">padding</span> <span class="p">:</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">RSA_PKCS1_PADDING</span><span class="p">},</span>
                <span class="nx">bufferToEncrypt</span><span class="p">);</span>
            
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;base64&quot;</span><span class="p">));</span>
            
            <span class="kc">null</span><span class="p">;</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">from</span> <span class="nn">M2Crypto</span> <span class="kn">import</span> <span class="n">RSA</span><span class="p">,</span> <span class="n">X509</span>
            <span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>
            
            <span class="n">INITIATOR_PASS</span>  <span class="o">=</span> <span class="s">&quot;YOUR_PASSWORD&quot;</span>
            <span class="n">CERTIFICATE_FILE</span> <span class="o">=</span> <span class="s">&quot;PATH_TO_CERTIFICATE_FILE&quot;</span>
            
            <span class="k">def</span> <span class="nf">encryptInitiatorPassword</span><span class="p">():</span>
                <span class="n">cert_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">CERTIFICATE_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">cert_data</span> <span class="o">=</span> <span class="n">cert_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c">#read certificate file</span>
                <span class="n">cert_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
                <span class="n">cert</span> <span class="o">=</span> <span class="n">X509</span><span class="o">.</span><span class="n">load_cert_string</span><span class="p">(</span><span class="n">cert_data</span><span class="p">)</span>
                <span class="c">#pub_key = X509.load_cert_string(cert_data)</span>
                <span class="n">pub_key</span> <span class="o">=</span> <span class="n">cert</span><span class="o">.</span><span class="n">get_pubkey</span><span class="p">()</span>
                <span class="n">rsa_key</span> <span class="o">=</span> <span class="n">pub_key</span><span class="o">.</span><span class="n">get_rsa</span><span class="p">()</span>
                <span class="n">cipher</span> <span class="o">=</span> <span class="n">rsa_key</span><span class="o">.</span><span class="n">public_encrypt</span><span class="p">(</span><span class="n">INITIATOR_PASS</span><span class="p">,</span> <span class="n">RSA</span><span class="o">.</span><span class="n">pkcs1_padding</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="n">encryptInitiatorPassword</span><span class="p">()</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$publicKey</span> <span class="o">=</span> <span class="s2">&quot;PATH_TO_CERTICATE_FILE&quot;</span><span class="p">;</span>
            <span class="nv">$plaintext</span> <span class="o">=</span> <span class="s2">&quot;YOUR_PASSWORD&quot;</span><span class="p">;</span>
            
            <span class="nb">openssl_public_encrypt</span><span class="p">(</span><span class="nv">$plaintext</span><span class="p">,</span> <span class="nv">$encrypted</span><span class="p">,</span> <span class="nv">$publicKey</span><span class="p">,</span> <span class="nx">OPENSSL_PKCS1_PADDING</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">);</span>
            
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <p>M-Pesa Core authenticates a transaction by decrypting the security credentials. Security credentials are generated by encrypting the base64 encoded initiator password with M-Pesa&rsquo;s public key, a X509 certificate.</p>
            
            <p>The algorithm for generating security credentials is as follows:</p>
            
            <ul>
              <li>
              <p>Write the unencrypted password into a byte array.</p>
              </li>
              <li>
              <p>Encrypt the array with the M-Pesa public key certificate. Use the RSA algorithm, and use PKCS #1.5 padding (not OAEP), and add the result to the encrypted stream.</p>
              </li>
              <li>
              <p>Convert the resulting encrypted byte array into a string using base64 encoding. The resulting base64 encoded string is the security credential.</p>
              </li>
            </ul>
            
            <h1 id="command-ids">Command IDs</h1>
            
            <table>
              <thead>
                <tr>
                  <th>Command ID</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>TransactionReversal</td>
                  <td>Reversal for an erroneous C2B transaction.</td>
                </tr>
                <tr>
                  <td>SalaryPayment</td>
                  <td>Used to send money from an employer to employees e.g. salaries</td>
                </tr>
                <tr>
                  <td>BusinessPayment</td>
                  <td>Used to send money from business to customer e.g. refunds</td>
                </tr>
                <tr>
                  <td>PromotionPayment</td>
                  <td>Used to send money when promotions take place e.g. raffle winners</td>
                </tr>
                <tr>
                  <td>AccountBalance</td>
                  <td>Used to check the balance in a paybill/buy goods account (includes utility, MMF, Merchant, Charges paid account).</td>
                </tr>
                <tr>
                  <td>CustomerPayBillOnline</td>
                  <td>Used to simulate a transaction taking place in the case of C2B Simulate Transaction or to initiate a transaction on behalf of the customer (STK Push).</td>
                </tr>
                <tr>
                  <td>TransactionStatusQuery</td>
                  <td>Used to query the details of a transaction.</td>
                </tr>
                <tr>
                  <td>CheckIdentity</td>
                  <td>Similar to STK push, uses M-Pesa PIN as a service.</td>
                </tr>
                <tr>
                  <td>BusinessPayBill</td>
                  <td>Sending funds from one paybill to another paybill</td>
                </tr>
                <tr>
                  <td>BusinessBuyGoods</td>
                  <td>sending funds from buy goods to another buy goods.</td>
                </tr>
                <tr>
                  <td>DisburseFundsToBusiness</td>
                  <td>Transfer of funds from utility to MMF account.</td>
                </tr>
                <tr>
                  <td>BusinessToBusinessTransfer</td>
                  <td>Transferring funds from one paybills MMF to another paybills MMF account.</td>
                </tr>
                <tr>
                  <td>BusinessTransferFromMMFToUtility</td>
                  <td>Transferring funds from paybills MMF to another paybills utility account.</td>
                </tr>
              </tbody>
            </table>
            
            <h1 id="identifier-types">Identifier Types</h1>
            
            <p>Identifier types - both sender and receiver - identify an M-Pesa transaction&rsquo;s sending and receiving party as either a shortcode, a till number or a MSISDN (phone number). There are three identifier types that can be used with M-Pesa APIs.</p>
            
            <table>
              <thead>
                <tr>
                  <th>Identifier</th>
                  <th>Identity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>MSISDN</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Till Number</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Shortcode</td>
                </tr>
              </tbody>
            </table>
            
            <h1 id="m-pesa-result-and-response-codes">M-Pesa Result and Response Codes</h1>
            
            <h2 id="m-pesa-result-codes">M-Pesa Result Codes</h2>
            
            <table>
              <thead>
                <tr>
                  <th>Result Code</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0</td>
                  <td>Success</td>
                </tr>
                <tr>
                  <td>1</td>
                  <td>Insufficient Funds</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Less Than Minimum Transaction Value</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>More Than Maximum Transaction Value</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Would Exceed Daily Transfer Limit</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>Would Exceed Minimum Balance</td>
                </tr>
                <tr>
                  <td>6</td>
                  <td>Unresolved Primary Party</td>
                </tr>
                <tr>
                  <td>7</td>
                  <td>Unresolved Receiver Party</td>
                </tr>
                <tr>
                  <td>8</td>
                  <td>Would Exceed Maxiumum Balance</td>
                </tr>
                <tr>
                  <td>11</td>
                  <td>Debit Account Invalid</td>
                </tr>
                <tr>
                  <td>12</td>
                  <td>Credit Account Invaliud</td>
                </tr>
                <tr>
                  <td>13</td>
                  <td>Unresolved Debit Account</td>
                </tr>
                <tr>
                  <td>14</td>
                  <td>Unresolved Credit Account</td>
                </tr>
                <tr>
                  <td>15</td>
                  <td>Duplicate Detected</td>
                </tr>
                <tr>
                  <td>17</td>
                  <td>Internal Failure</td>
                </tr>
                <tr>
                  <td>20</td>
                  <td>Unresolved Initiator</td>
                </tr>
                <tr>
                  <td>26</td>
                  <td>Traffic blocking condition in place</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="m-pesa-response-codes-from-client-back-to-gateway">M-Pesa Response Codes (from client back to gateway)</h2>
            
            <p>Response codes are sent from the clients endpoints back to the gateway. This is done to acknowledge that the client has received the results.</p>
            
            <table>
              <thead>
                <tr>
                  <th>Result Code</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0</td>
                  <td>Success (for C2B)</td>
                </tr>
                <tr>
                  <td>00000000</td>
                  <td>Success (For APIs that are not C2B)</td>
                </tr>
                <tr>
                  <td>1 or any other number</td>
                  <td>Rejecting the transaction</td>
                </tr>
              </tbody>
            </table>
            
            <h1 id="test-credentials">Test Credentials</h1>
            
            <p>To facilitate testing of sandbox apps, we have provided test credentials consisting of:</p>
            
            <ul>
              <li>Test Shortcodes</li>
              <li>Initiator Name</li>
              <li>Security Credential</li>
              <li>Test MSISDN</li>
              <li>Lipa Na M-Pesa Online Shortcode</li>
              <li>Lipa Na M-Pesa Online Passkey</li>
            </ul>
            
            <p>There are two shortcodes in the <a href="https://developer.safaricom.co.ke/test_credentials">test credentials</a> page - Shortcode 1 and Shortcode 2. The initiator name and security credentials are associated with Shortcode 1. For M-Pesa APIs that have &lsquo;PartyA&rsquo; in their request parameters, use Shortcode 1; Shortcode 2 will be used for &lsquo;PartyB&rsquo;.</p>
            
            <p>The test credentials page has a utility to generate an M-Pesa security credential. You use the utility by entering the string alongside &lsquo;Security Credential&rsquo; with no preceding and trailing spaces and then clicking on &lsquo;Generate Credentials&rsquo; button. You will then get an M-Pesa security credential for use in invoking an API that requires a security credential in its request parameters.</p>
            
            <p>The &lsquo;Lipa Na M-Pesa Online Shortcode&rsquo; is a production shortcode. On the sandbox, API calls using Lipa Na M-Pesa Online Payment API can only be made to this shortcode and money will be transacted. Auto-reversal of funds received on this shortcode will be done every night at 23:59 HRS EAT (midnight).</p>
            
            <p>The &lsquo;Lipa Na M-Pesa Online Passkey&rsquo; is used to create a password for use when making a Lipa Na M-Pesa Online Payment API call. The password is generated by base64 encoding the passkey, shortcode and timestamp, the resultant string from this encoding is the password.</p>
            
            <p>Test credentials expire after three days, after which you will be issued with fresh test credentials. Lipa Na M-Pesa Online Shortcode and Lipa Na M-Pesa Passkey do not expire.</p>
            
            <h1 id="test-cases">Test Cases</h1>
            
            <p>The developer will download test cases when they are creating a sandbox app. The test cases are in an Excel spreadsheet which the developer will fill with results from the API calls they make for each test scenarios.</p>
            
            <p>Once the test case scenarios have been duly filled, the developer will upload the filled Excel spreadsheet during the &lsquo;Go Live&rsquo; process. Our support team will then review the test cases and then either approve or reject the production app.</p>
            
            <aside class="notice">Test cases are meant to ensure that the developer understands the structure of requests and responses of an API. The support team will approve or reject a production app based on the uploaded test cases. The developer does not need to fill all test case scenarios, only scenarios for the API they intend to consume.</aside>
            
            <h1 id="going-live">Going Live</h1>
            
            <p>Having played with the APIs on the sandbox and filled the test cases for an API(s) that you would like to move into production with, the developer will initiate the &lsquo;Go Live&rsquo; process.</p>
            
            <p>To go live with an M-Pesa API, the developer will need to prove ownership or authorization to use an M-Pesa shortcode. M-Pesa Shortcodes are managed on the M-Pesa Web Portal where owners of the shortcodes can add users and assign roles. When a request to verify ownership or authorization to use an M-Pesa shortcode is received, an OTP - one time password - is sent to the user with a Business Manager and Business Administrator role and a notification is sent to users with a Business Manager role.</p>
            
            <p>For non M-Pesa APIs, the developer will provide a valid identification document known to Safaricom for example a National ID or passport used to register as a Safaricom subscriber.</p>
            
            <h2 id="step-by-step-go-live-guide">Step by Step Go Live Guide</h2>
            
            <p><strong>1. Upload test cases</strong></p>
            
            <p>From the menu bar, click on &lsquo;Go Live&rsquo;</p>
            
            <p><img alt="go live" src="/sites/all/themes/apigee_responsive_custom/images/go_live.png" /></p>
            
            <p>Upload a filled out test cases (Excel spreadsheet) and click &lsquo;Upload&rsquo;, once uploaded click on the check box as consent to the &lsquo;Terms and Conditions&rsquo;. Click on &lsquo;Next&rsquo;.</p>
            
            <p><img alt="upload test cases" src="/sites/all/themes/apigee_responsive_custom/images/go_live_step_1.png" /></p>
            
            <p><strong>2. Select a verification type</strong></p>
            
            <p>Verification can be by a &lsquo;Shortcode&rsquo; or a &lsquo;Document ID&rsquo;.</p>
            
            <p><img alt="verification" src="/sites/all/themes/apigee_responsive_custom/images/go_live_step_2a.png" /></p>
            
            <p>To verify an M-Pesa Shortcode - input your &lsquo;organisation short code&rsquo;, &lsquo;organisation name&rsquo; and &lsquo;M-Pesa User Name&rsquo;.</p>
            
            <p>The &lsquo;M-Pesa User Name&rsquo; is user name used on the M-Pesa Web Portal for the Business Administrator or Business Manager or Business Operator roles within the organisation in M-Pesa.</p>
            
            <p><img alt="verification_shortcode" src="/sites/all/themes/apigee_responsive_custom/images/go_live_step_2b.png" /></p>
            
            <p>To verify a &lsquo;Document ID&rsquo;, select a &lsquo;Document Type&rsquo;, input the &lsquo;Document ID&rsquo; and &lsquo;Organisation Name&rsquo;.</p>
            
            <p>The &lsquo;Document Type&rsquo; used are any document submitted to Safaricom while subscribing to any Safaricom services, for example, registering for an M-Pesa account or Safaricom MSISDN.</p>
            
            <p>This verification type is for non M-Pesa APIs.</p>
            
            <p><img alt="verification_document_type" src="/sites/all/themes/apigee_responsive_custom/images/go_live_step_2c.png" /></p>
            
            <p>Click &lsquo;Verify&rsquo;</p>
            
            <p><strong>3. OTP Confirmation</strong></p>
            
            <p>During the verification stage you will be required to receive an OTP so as to verify you are the owner of the paybill.</p>
            
            <p>This requires you to set the password on the M-Pesa portal. The steps are as below:</p>
            
            <p>a) Login as a business administrator.</p>
            
            <p>b) Click on operators on the left hand corner on the M-Pesa portal and click on search. This will show you all your operators.</p>
            
            <p>c) You will find business administrators and business operators. Find the user which you are going to use on the portal and click edit.</p>
            
            <p>d) Click on KYC Info and edit the following information as shown below</p>
            
            <p><img alt="OTP" src="/sites/all/themes/apigee_responsive_custom/images/operator.png" /></p>
            
            <aside class="notice">Ensure the MSISDN is entered in format 2547XXXXXXXX</aside>
            
            <p>e) Click submit and save the changes</p>
            
            <p>You then Continue the rest of the process on daraja portal.</p>
            
            <p>A verification will be done and a six digit passcode, OTP - one time password, will be sent via SMS to the MSISDN that you have entered above.</p>
            
            <p>If the verification type was an M-Pesa Shortcode, the OTP will be sent to MSISDN belonging to the M-Pesa Business Administrator or Manager or Operator. An SMS notification will also be sent to other users within the M-Pesa organisation notifying them of the intention to integrate their shortcode to M-Pesa APIs.</p>
            
            <p>If verification type was a Document ID, the OTP will be sent to the MSISDN associated with the document.(not applicable for M-Pesa APIs)</p>
            
            <p><img alt="otp_confirmation" src="/sites/all/themes/apigee_responsive_custom/images/go_live_step_3.png" /></p>
            
            <aside class="notice">The OTP will expire after three minutes. If an OTP is not submitted for confirmation within three minutes you can request a new OTP by clicking &lsquo;Resend OTP&rsquo;. All OTPs will be sent via SMS. The M- Pesa Business Manager or Business Operator will need to log on to the M-Pesa Web portal and update their profiles with their current MSISDNs.</aside>
            
            <p>The developer will select the API Products they will be integrating to, select only the API Products for which you have filled test case scenarios for in the filled test cases Excel spreadsheet uploaded at step 1. The API Products will be presented depending on the verification type used. For M-Pesa shortcode verification type, the API products displayed will depend on the M-Pesa product type configured on M-Pesa for that shortcode.</p>
            
            <p>For &lsquo;Document ID&rsquo; verification method, non M-Pesa API Products will be displayed.</p>
            
            <p>Click &lsquo;Submit&rsquo; once you have selected the API Product(s) and input the OTP.</p>
            
            <p><strong>4. Production URLs and Credentials</strong></p>
            
            <p>Your application to &lsquo;Go Live&rsquo; will be reviewed for approval by our support teams. The approval process involves a review of the uploaded test cases ensuring that all test scenarios were successfully tested and the actual results filled for the test scenarios are appropriate.</p>
            
            <p><img alt="production" src="/sites/all/themes/apigee_responsive_custom/images/go_live_step_4.png" /></p>
            
            <p>To switch to your production app page, click on the switch adjacent to your email address and select the organisation name you submitted earlier during the verification process. Your production app will be automatically be assigned a name and will have a &lsquo;pending&rsquo; tag.</p>
            
            <p>Once your production app is approved, you will receive an email notification of the production urls for the APIs in the approved API Products. The production app will be tagged &lsquo;approved&rsquo; and its consumer key and consumer secret can now be used.</p>
            
            <p><strong>5. Setting the Security credential (for B2C, B2B, Transaction Status, Reversal, Account Balance APIs)</strong></p>
            
            <p>The last step is setting the secruity credential tag. (This does not apply to Lipa Na Mpesa Online and C2B API&rsquo;s) Security credential allows us as M-Pesa to authenticate that the request has been generated by a particular paybill owner.</p>
            
            <p>After your app is approved you will receive an email from no_reply@m-pesa.com with the api password as follows:</p>
            
            <p>&ldquo;Your M-PESA user account has been created. Your operator id is null and your user name is testapi. Your PIN is null and your password is null.&rdquo;</p>
            
            <p>The following are the steps that are to be followed when setting the security credential:</p>
            
            <p>a. The first step is ensuring that the web Operator has the correct role (Set Restricted ORG API PASSWORD). The web operator with the correct role logs in and clicks Search, then clicks Operator. The operator should then enter the API Username in the Username field and Click Search.</p>
            
            <p>b. When the Operator details are displayed, click the icon in the Operation column.</p>
            
            <p><img alt="M-Pesa Portal1" src="/sites/all/themes/apigee_responsive_custom/images/operator1.png" /></p>
            
            <p>c. The API Operator details will be displayed. Click the Set Password button.</p>
            
            <p><img alt="M-Pesa Portal1" src="/sites/all/themes/apigee_responsive_custom/images/operator2.png" /></p>
            
            <p>d. Enter the preferred password. (Must contain a capital letter, small letter, number and special character)</p>
            
            <p><img alt="M-Pesa Portal1" src="/sites/all/themes/apigee_responsive_custom/images/operator3.png" /></p>
            
            <h2 id="inviting-developers">Inviting Developers</h2>
            
            <p>Once you have an approved production app, you can now invite other developers to help you to develop your app. You can only invite developers who also have developer accounts on Daraja.</p>
            
            <p>To invite a developer(s):</p>
            
            <p><strong>1.</strong> Switch to your production profile by clicking the switch to your right adjacent to your email address.</p>
            
            <p><strong>2.</strong> From the drop down menu that appears, click on &lsquo;Manage Companies&rsquo;.</p>
            
            <p><strong>3.</strong> The &lsquo;Manage Companies&rsquo; page will open. The page will have a list of companies that you have created or have been invited to.</p>
            
            <p>For companies you have created, your role will be &lsquo;Owner&rsquo; and &lsquo;Monetization Administrator&rsquo;. You can invite developers to your company by providing the email address they used in registering for a developer account. They will then get an email with an invitation link and join your company by consenting to the invitation.</p>
            
            <p>Once a developer has been invited to your company, they will have a &lsquo;Developer&rsquo; role by default. You can give a developer &lsquo;Company Administrator&rsquo; role. A developer with the &lsquo;Company Administrator&rsquo; role can invite other developers, assign and revoke roles to other developers and remove developers.</p>
            
            <p>If you have been invited to a company, you have access to the production apps of that company. You can then make API calls using the consumer key and consumer secret of any production app associated with the company you have been invited to.</p>
            
            <p>Only the owner of a company can edit or delete a production app(s) of their company. Invited developers, even those with a &lsquo;Company Administrator&rsquo; role, cannot edit or delete a production app(s).</p>
            
            <h1 id="m-pesa-apis">M-Pesa APIs</h1>
            
            <p>The following are the M-Pesa APIs that are available to test. This documentation provides sample codes and JSON responses to the right with these APIs.</p>
            
            <p>A Postman collection of these APIs are also available.</p>
            
            <p><a href="https://app.getpostman.com/run-collection/b15e9c78a78562cca241"><img alt="Run in Postman" src="https://run.pstmn.io/button.svg" /></a></p>
            
            <h2 id="b2c-api">B2C API</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">InitiatorName</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyB</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://your_timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://your_result_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Occasion</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">InitiatorName</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyB</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://your_timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://your_result_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Occasion</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span> <span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s">&quot;InitiatorName&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;CommandID&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Amount&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyA&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyB&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Remarks&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span> <span class="s">&quot;http://your_timeout_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;ResultURL&quot;</span><span class="p">:</span> <span class="s">&quot;http://your_result_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;Occasion&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span>
            <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;InitiatorName&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;CommandID&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Amount&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyA&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyB&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Remarks&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://your_timeout_url&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;ResultURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://your_result_url&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Occasion&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span>
                <span class="p">}</span>
              <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;InitiatorName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;SecurityCredential&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Amount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyB&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Remarks&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;QueueTimeOutURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://your_timeout_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ResultURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://your_result_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Occasion&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:InitiatorName</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:SecurityCredential</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CommandID</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Amount</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PartyA</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PartyB</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Remarks</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:QueueTimeOutURL</span><span class="w"> </span><span class="s">&quot;http://your_timeout_url&quot;</span><span class="w">
                  </span><span class="no">:ResultURL</span><span class="w"> </span><span class="s">&quot;http://your_result_url&quot;</span><span class="w">
                  </span><span class="no">:Occasion</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;InitiatorName\&quot;:\&quot; \&quot;,
              \&quot;SecurityCredential\&quot;:\&quot; \&quot;,
              \&quot;CommandID\&quot;:\&quot; \&quot;,
              \&quot;Amount\&quot;:\&quot; \&quot;,
              \&quot;PartyA\&quot;:\&quot; \&quot;,
              \&quot;PartyB\&quot;:\&quot; \&quot;,
              \&quot;Remarks\&quot;:\&quot; \&quot;,
              \&quot;QueueTimeOutURL\&quot;:\&quot;http://your_timeout_url\&quot;,
              \&quot;ResultURL\&quot;:\&quot;http://your_result_url\&quot;,
              \&quot;Occasion\&quot;:\&quot; \&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer YOUR_OAUTH_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="err">//</span><span class="w"> </span><span class="err">Sample</span><span class="w"> </span><span class="err">M-Pesa</span><span class="w"> </span><span class="err">Core</span><span class="w"> </span><span class="err">response</span><span class="w"> </span><span class="err">received</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">callback</span><span class="w"> </span><span class="err">url.</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">&quot;Result&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;ResultType&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;The service request has been accepted successfully.&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;OriginatorConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;19455-424535-1&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;AG_20170717_00006be9c8b5cc46abb6&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot;LGH3197RIB&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultParameters&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ResultParameter&quot;</span><span class="p">:[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionReceipt&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;LGH3197RIB&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionAmount&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">8000</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;B2CWorkingAccountAvailableFunds&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">150000</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;B2CUtilityAccountAvailableFunds&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">133568</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionCompletedDateTime&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;17.07.2017 10:54:57&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;ReceiverPartyPublicName&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;254708374149 - John Doe&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;B2CChargesPaidAccountAvailableFunds&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">0</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;B2CRecipientIsRegisteredCustomer&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Y&quot;</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                  </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">&quot;ReferenceData&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ReferenceItem&quot;</span><span class="p">:{</span><span class="w">
                    </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;QueueTimeoutURL&quot;</span><span class="p">,</span><span class="w">
                    </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;https://internalsandbox.safaricom.co.ke/mpesa/b2cresults/v1/submit&quot;</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>This API enables Business to Customer (B2C) transactions between a company and customers who are the end-users of its products or services. Use of this API requires a valid and verified B2C M-Pesa Short code.</p>
            
            <h3 id="b2c-resource-url">B2C Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/b2c/v1/paymentrequest</code></p>
            
            <h3 id="b2c-query-parameters">B2C Query Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>InitiatorName</td>
                  <td>This is the credential/username used to authenticate the transaction request.</td>
                </tr>
                <tr>
                  <td>SecurityCredential</td>
                  <td>Base64 encoded string of the B2C short code and password, which is encrypted using M-Pesa public key and validates the transaction on M-Pesa Core system.</td>
                </tr>
                <tr>
                  <td>CommandID</td>
                  <td>Unique command for each transaction type e.g. SalaryPayment, BusinessPayment, PromotionPayment</td>
                </tr>
                <tr>
                  <td>Amount</td>
                  <td>The amount being transacted</td>
                </tr>
                <tr>
                  <td>PartyA</td>
                  <td>Organization&rsquo;s shortcode initiating the transaction.</td>
                </tr>
                <tr>
                  <td>PartyB</td>
                  <td>Phone number receiving the transaction</td>
                </tr>
                <tr>
                  <td>Remarks</td>
                  <td>Comments that are sent along with the transaction.</td>
                </tr>
                <tr>
                  <td>QueueTimeOutURL</td>
                  <td>The timeout end-point that receives a timeout response.</td>
                </tr>
                <tr>
                  <td>ResultURL</td>
                  <td>The end-point that receives the response of the transaction</td>
                </tr>
                <tr>
                  <td>Occasion</td>
                  <td>Optional</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="b2b-api">B2B API</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SenderIdentifierType</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">RecieverIdentifierType</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyB</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">AccountReference</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">http://your_timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">http://your_result_url</span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">SenderIdentifierType</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">RecieverIdentifierType</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">PartyB</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">AccountReference</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">http://your_timeout_url</span><span class="se">\&quot;</span><span class="s2">,
                  </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">http://your_result_url</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span> <span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s">&quot;Initiator&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;SecurityCredential&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;CommandID&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;SenderIdentifierType&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;RecieverIdentifierType&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Amount&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyA&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyB&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;AccountReference&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Remarks&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span> <span class="s">&quot;http://your_timeout_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;ResultURL&quot;</span><span class="p">:</span> <span class="s">&quot;http://your_result_url&quot;</span>
            <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;Initiator&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;SecurityCredential&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;CommandID&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;SenderIdentifierType&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;RecieverIdentifierType&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Amount&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyA&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyB&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;AccountReference&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Remarks&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://your_timeout_url&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;ResultURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://your_result_url&quot;</span>
                <span class="p">}</span>
              <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;Initiator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;SecurityCredential&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;SenderIdentifierType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;RecieverIdentifierType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Amount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyB&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;AccountReference&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Remarks&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;QueueTimeOutURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://your_timeout_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ResultURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://your_result_url&#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:Initiator</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:SecurityCredential</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CommandID</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:SenderIdentifierType</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:RecieverIdentifierType</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Amount</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PartyA</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PartyB</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:AccountReference</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Remarks</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:QueueTimeOutURL</span><span class="w"> </span><span class="s">&quot;http://your_timeout_url&quot;</span><span class="w">
                  </span><span class="no">:ResultURL</span><span class="w"> </span><span class="s">&quot;http://your_result_url&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;Initiator\&quot;: \&quot; \&quot;,
                  \&quot;SecurityCredential\&quot;: \&quot; \&quot;,
                  \&quot;CommandID\&quot;: \&quot; \&quot;,
                  \&quot;SenderIdentifierType\&quot;: \&quot; \&quot;,
                  \&quot;RecieverIdentifierType\&quot;: \&quot; \&quot;,
                  \&quot;Amount\&quot;: \&quot; \&quot;,
                  \&quot;PartyA\&quot;: \&quot; \&quot;,
                  \&quot;PartyB\&quot;: \&quot; \&quot;,
                  \&quot;AccountReference\&quot;: \&quot; \&quot;,
                  \&quot;Remarks\&quot;: \&quot; \&quot;,
                  \&quot;QueueTimeOutURL\&quot;: \&quot;http://your_timeout_url\&quot;,
                  \&quot;ResultURL\&quot;: \&quot;http://your_result_url\&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;Result&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;ResultType&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;The service request has been accepted successfully.&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;OriginatorConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;8551-61996-3&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;AG_20170727_00006baee344f4ce0796&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot;LGR519G2QV&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultParameters&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ResultParameter&quot;</span><span class="p">:[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;InitiatorAccountCurrentBalance&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;{ Amount={BasicAmount=46713.00, MinimumAmount=4671300, CurrencyCode=KES}}&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;DebitAccountCurrentBalance&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;{Amount={BasicAmount=46713.00, MinimumAmount=4671300, CurrencyCode=KES}}&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Amount&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">10</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;DebitPartyAffectedAccountBalance&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Working Account|KES|46713.00|46713.00|0.00|0.00&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;TransCompletedTime&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">20170727102524</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;DebitPartyCharges&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Business Pay Bill Charge|KES|77.00&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;ReceiverPartyPublicName&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;603094 - Safaricom3117&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Currency&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;KES&quot;</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                  </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">&quot;ReferenceData&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ReferenceItem&quot;</span><span class="p">:[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;BillReferenceNumber&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;aaa&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;QueueTimeoutURL&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;https://internalsandbox.safaricom.co.ke/mpesa/b2bresults/v1/submit&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Occasion&quot;</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                  </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>This API enables Business to Business (B2B) transactions between a business and another business. Use of this API requires a valid and verified B2B M-Pesa short code for the business initiating the transaction and the both businesses involved in the transaction.</p>
            
            <h3 id="b2b-resource-url">B2B - Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/b2b/v1/paymentrequest</code></p>
            
            <h3 id="b2b-request-parameters">B2B - Request Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Initiator</td>
                  <td>This is the credential/username used to authenticate the transaction request.</td>
                </tr>
                <tr>
                  <td>SecurityCredential</td>
                  <td>Base64 encoded string of the B2B short code and password, which is encrypted using M-Pesa public key and validates the transaction on M-Pesa Core system.</td>
                </tr>
                <tr>
                  <td>CommandID</td>
                  <td>Unique command for each transaction type, possible values are: BusinessPayBill, MerchantToMerchantTransfer, MerchantTransferFromMerchantToWorking, MerchantServicesMMFAccountTransfer, AgencyFloatAdvance</td>
                </tr>
                <tr>
                  <td>Amount</td>
                  <td>The amount being transacted.</td>
                </tr>
                <tr>
                  <td>PartyA</td>
                  <td>Organization&rsquo;s short code initiating the transaction.</td>
                </tr>
                <tr>
                  <td>SenderIdentifier</td>
                  <td>Type of organization sending the transaction.</td>
                </tr>
                <tr>
                  <td>PartyB</td>
                  <td>Organization&rsquo;s short code receiving the funds being transacted.</td>
                </tr>
                <tr>
                  <td>RecieverIdentifierType</td>
                  <td>Type of organization receiving the funds being transacted.</td>
                </tr>
                <tr>
                  <td>Remarks</td>
                  <td>Comments that are sent along with the transaction.</td>
                </tr>
                <tr>
                  <td>QueueTimeOutURL</td>
                  <td>The path that stores information of time out transactions.it should be properly validated to make sure that it contains the port, URI and domain name or publicly available IP.</td>
                </tr>
                <tr>
                  <td>ResultURL</td>
                  <td>The path that receives results from M-Pesa it should be properly validated to make sure that it contains the port, URI and domain name or publicly available IP.</td>
                </tr>
                <tr>
                  <td>AccountReference</td>
                  <td>Account Reference mandatory for &ldquo;BusinessPaybill&rdquo; CommandID.</td>
                </tr>
              </tbody>
            </table>
            
            <h3 id="b2b-response-parameters">B2B Response Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ConversationID</td>
                  <td>A unique numeric code generated by the M-Pesa system of the response to a request.</td>
                </tr>
                <tr>
                  <td>OriginatorConversationID</td>
                  <td>A unique numeric code generated by the M-Pesa system of the request.</td>
                </tr>
                <tr>
                  <td>ResponseDescription</td>
                  <td>A response message from the M-Pesa system accompanying the response to a request.</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="c2b-api">C2B API</h2>
            
            <p>This API enables Paybill and Buy Goods merchants to integrate to M-Pesa and receive real time payments notifications.</p>
            
            <h3 id="register-url">Register URL</h3>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
                </span><span class="se">\&quot;</span><span class="s2">ShortCode</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ResponseType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ConfirmationURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://ip_address:port/confirmation</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ValidationURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://ip_address:port/validation_url</span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">ShortCode</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">ShortCode</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ResponseType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">ResponseType</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ConfirmationURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://ip_address:port/confirmation</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ValidationURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">http://ip_address:port/validation_url</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;http://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;ShortCode&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
                <span class="s">&quot;ResponseType&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
                <span class="s">&quot;ConfirmationURL&quot;</span><span class="p">:</span> <span class="s">&quot;http://ip_address:port/confirmation&quot;</span><span class="p">,</span>
                <span class="s">&quot;ValidationURL&quot;</span><span class="p">:</span> <span class="s">&quot;http://ip_address:port/validation_url&quot;</span><span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                  <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;ShortCode&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ResponseType&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ConfirmationURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://ip_address:port/confirmation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ValidationURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://ip_address:port/validation_url&quot;</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the </span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;ShortCode&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;ResponseType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;ConfirmationURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://ip_address:port/confirmation&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ValidationURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://ip_address:port/validation_url&#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w">
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:ShortCode</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:ResponseType</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:ConfirmationURL</span><span class="w"> </span><span class="s">&quot;http://ip_address:port/confirmation&quot;</span><span class="w">
                  </span><span class="no">:ValidationURL</span><span class="w"> </span><span class="s">&quot;http://ip_address:port/validation_url&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;ShortCode\&quot;:\&quot;ShortCode\&quot;,
                \&quot;ResponseType\&quot;:\&quot;ResponseType\&quot;,
                \&quot;ConfirmationURL\&quot;:\&quot;http://ip_address:port/confirmation\&quot;,
                \&quot;ValidationURL\&quot;:\&quot;http://ip_address:port/validation_url\&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <p>The C2B Register URL API registers the 3rd party&rsquo;s confirmation and validation URLs to M-Pesa ; which then maps these URLs to the 3rd party shortcode. Whenever M-Pesa receives a transaction on the shortcode, M-Pesa triggers a validation request against the validation URL and the 3rd party system responds to M-Pesa with a validation response (either a success or an error code). The response expected is the success code the 3rd party</p>
            
            <p>M-Pesa completes or cancels the transaction depending on the validation response it receives from the 3rd party system. A confirmation request of the transaction is then sent by M-Pesa through the confirmation URL back to the 3rd party which then should respond with a success acknowledging the confirmation.</p>
            
            <aside class="warning">The 3rd party resource URLs for both confirmation and validation must be HTTPS in production. Validation is an optional feature that needs to be activated on M-Pesa, the owner of the shortcode needs to make this request for activation.</aside>
            
            <h4 id="c2b-register-url-resource-url">C2B Register URL - Resource URL</h4>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/c2b/v1/registerurl</code></p>
            
            <h4 id="c2b-register-url-request-parameters">C2B Register URL - Request Parameters</h4>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ValidationURL</td>
                  <td>Validation URL for the client.</td>
                </tr>
                <tr>
                  <td>ConfirmationURL</td>
                  <td>Confirmation URL for the client.</td>
                </tr>
                <tr>
                  <td>ResponseType</td>
                  <td>Default response type for timeout.</td>
                </tr>
                <tr>
                  <td>ShortCode</td>
                  <td>The short code of the organization.</td>
                </tr>
              </tbody>
            </table>
            
            <h4 id="register-url-response-parameters">Register URL - Response Parameters</h4>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ConversationID</td>
                  <td>A unique numeric code generated by the M-Pesa system of the response to a request.</td>
                </tr>
                <tr>
                  <td>OriginatorConversationID</td>
                  <td>A unique numeric code generated by the M-Pesa system of the request.</td>
                </tr>
                <tr>
                  <td>ResponseDescription</td>
                  <td>A response message from the M-Pesa system accompanying the response to a request.</td>
                </tr>
              </tbody>
            </table>
            
            <h3 id="c2b-simulate-transaction">C2B Simulate Transaction</h3>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">ShortCode</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">CustomerPayBillOnline</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Msisdn</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">BillRefNumber</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{ </span><span class="se">\&quot;</span><span class="s2">ShortCode</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">CustomerPayBillOnline</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Msisdn</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">BillRefNumber</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2"> }&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;ACCESS_TOKEN&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;ShortCode&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;CommandID&quot;</span><span class="p">:</span><span class="s">&quot;CustomerPayBillOnline&quot;</span><span class="p">,</span>
              <span class="s">&quot;Amount&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Msisdn&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;BillRefNumber&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span> <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                  <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="c1">//Fill in the request parameters with valid values</span>
                    <span class="s2">&quot;ShortCode&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;CommandID&quot;</span><span class="p">:</span><span class="s2">&quot;CustomerPayBillOnline&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Amount&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Msisdn&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;BillRefNumber&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&#39;</span><span class="p">;</span>
            
              <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
              <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
              <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
              <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                      <span class="c1">//Fill in the request parameters with valid values
            </span>         <span class="s1">&#39;ShortCode&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
                     <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CustomerPayBillOnline&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Amount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Msisdn&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
                     <span class="s1">&#39;BillRefNumber&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;00000&#39;</span>
              <span class="p">);</span>
            
              <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
              <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
              <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
              <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
              <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
              <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
              <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:ShortCode</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CommandID</span><span class="w"> </span><span class="s">&quot;CustomerPayBillOnline&quot;</span><span class="w">
                  </span><span class="no">:Amount</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Msisdn</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:BillRefNumber</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;ShortCode\&quot;:\&quot; \&quot;,
              \&quot;CommandID\&quot;:\&quot;CustomerPayBillOnline\&quot;,
              \&quot;Amount\&quot;:\&quot; \&quot;,
              \&quot;Msisdn\&quot;:\&quot; \&quot;,
              \&quot;BillRefNumber\&quot;:\&quot; \&quot; }&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="err">//</span><span class="w"> </span><span class="err">Validation</span><span class="w"> </span><span class="err">Response</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;TransactionType&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;TransID&quot;</span><span class="p">:</span><span class="s2">&quot;LGR219G3EY&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;TransTime&quot;</span><span class="p">:</span><span class="s2">&quot;20170727104247&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;TransAmount&quot;</span><span class="p">:</span><span class="s2">&quot;10.00&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;BusinessShortCode&quot;</span><span class="p">:</span><span class="s2">&quot;600134&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;BillRefNumber&quot;</span><span class="p">:</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;InvoiceNumber&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;OrgAccountBalance&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;ThirdPartyTransID&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;MSISDN&quot;</span><span class="p">:</span><span class="s2">&quot;254708374149&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;FirstName&quot;</span><span class="p">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;MiddleName&quot;</span><span class="p">:</span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;LastName&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="w">
            </span><span class="p">}</span><span class="w">
            
            </span><span class="err">//Confirmation</span><span class="w"> </span><span class="err">Respose</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;TransactionType&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;TransID&quot;</span><span class="p">:</span><span class="s2">&quot;LGR219G3EY&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;TransTime&quot;</span><span class="p">:</span><span class="s2">&quot;20170727104247&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;TransAmount&quot;</span><span class="p">:</span><span class="s2">&quot;10.00&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;BusinessShortCode&quot;</span><span class="p">:</span><span class="s2">&quot;600134&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;BillRefNumber&quot;</span><span class="p">:</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;InvoiceNumber&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;OrgAccountBalance&quot;</span><span class="p">:</span><span class="s2">&quot;49197.00&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;ThirdPartyTransID&quot;</span><span class="p">:</span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;MSISDN&quot;</span><span class="p">:</span><span class="s2">&quot;254708374149&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;FirstName&quot;</span><span class="p">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;MiddleName&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;LastName&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <h4 id="c2b-simulate-transaction-resource-url">C2B Simulate Transaction - Resource URL</h4>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/c2b/v1/simulate</code></p>
            
            <h4 id="c2b-simulate-transaction-request-parameters">C2B Simulate Transaction - Request Parameters</h4>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>CommandID</td>
                  <td>Unique command for each transaction type.</td>
                </tr>
                <tr>
                  <td>Amount</td>
                  <td>The amount been transacted.</td>
                </tr>
                <tr>
                  <td>MSISDN</td>
                  <td>MSISDN (phone number) sending the transaction, start with country code without the plus(+) sign.</td>
                </tr>
                <tr>
                  <td>BillRefNumber</td>
                  <td>Bill Reference Number (Optional).</td>
                </tr>
                <tr>
                  <td>ShortCode</td>
                  <td>6 digit M-Pesa Till Number or PayBill Number</td>
                </tr>
              </tbody>
            </table>
            
            <h4 id="c2b-simulate-transaction-response-parameters">C2B Simulate Transaction - Response Parameters</h4>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ConversationID</td>
                  <td>A unique numeric code generated by the M-Pesa system of the response to a request.</td>
                </tr>
                <tr>
                  <td>OriginatorConversationID</td>
                  <td>A unique numeric code generated by the M-Pesa system of the request.</td>
                </tr>
                <tr>
                  <td>ResponseDescription</td>
                  <td>A response message from the M-Pesa system accompanying the response to a request.</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="account-balance-api">Account Balance API</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
                </span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">security credential</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">AccountBalance</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">shortcode</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">IdentifierType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">4</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/timeout_url</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/result_url</span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">AccountBalance</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">IdentifierType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">4</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/timeout_url</span><span class="se">\&quot;</span><span class="s2">,
                </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/result_url</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Initiator&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
                <span class="s">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
                <span class="s">&quot;CommandID&quot;</span><span class="p">:</span><span class="s">&quot;AccountBalance&quot;</span><span class="p">,</span>
                <span class="s">&quot;PartyA&quot;</span><span class="p">:</span><span class="s">&quot;shortcode&quot;</span><span class="p">,</span>
                <span class="s">&quot;IdentifierType&quot;</span><span class="p">:</span><span class="s">&quot;4&quot;</span><span class="p">,</span>
                <span class="s">&quot;Remarks&quot;</span><span class="p">:</span><span class="s">&quot;Remarks&quot;</span><span class="p">,</span>
                <span class="s">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span><span class="s">&quot;https://ip_address:port/timeout_url&quot;</span><span class="p">,</span>
                <span class="s">&quot;ResultURL&quot;</span><span class="p">:</span><span class="s">&quot;https://ip_address:port/result_url&quot;</span>
                <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                  <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Initiator&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;CommandID&quot;</span><span class="p">:</span><span class="s2">&quot;AccountBalance&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;PartyA&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;IdentifierType&quot;</span><span class="p">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Remarks&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://ip_address:port/timeout_url&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ResultURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://ip_address:port/result_url&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Initiator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;SecurityCredential&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AccountBalance&#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;IdentifierType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Remarks&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;QueueTimeOutURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/timeout_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ResultURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/result_url&#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:Initiator</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:SecurityCredential</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CommandID</span><span class="w"> </span><span class="s">&quot;AccountBalance&quot;</span><span class="w">
                  </span><span class="no">:PartyA</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:IdentifierType</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="w">
                  </span><span class="no">:Remarks</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:QueueTimeOutURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/timeout_url&quot;</span><span class="w">
                  </span><span class="no">:ResultURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/result_url&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;Initiator\&quot;:\&quot; \&quot;,
                \&quot;SecurityCredential\&quot;:\&quot; \&quot;,
                \&quot;CommandID\&quot;:\&quot;AccountBalance\&quot;,
                \&quot;PartyA\&quot;:\&quot; \&quot;,
                \&quot;IdentifierType\&quot;:\&quot;4\&quot;,
                \&quot;Remarks\&quot;:\&quot; \&quot;,
                \&quot;QueueTimeOutURL\&quot;:\&quot;https://ip_address:port/timeout_url\&quot;,
                \&quot;ResultURL\&quot;:\&quot;https://ip_address:port/result_url\&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;Result&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;ResultType&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;The service request has b een accepted successfully.&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;OriginatorConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;19464-802673-1&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;AG_20170728_0000589b6252f7f25488&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot;LGS0000000&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultParameters&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ResultParameter&quot;</span><span class="p">:[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;AccountBalance&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Working Account|KES|46713.00|46713.00|0.00|0.00&amp;Float Account|KES|0.00|0.00|0.00|0.00&amp;Utility Account|KES|49217.00|49217.00|0.00|0.00&amp;Charges Paid Account|KES|-220.00|-220.00|0.00|0.00&amp;Organization Settlement Account|KES|0.00|0.00|0.00|0.00&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;BOCompletedTime&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">20170728095642</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                  </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">&quot;ReferenceData&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ReferenceItem&quot;</span><span class="p">:{</span><span class="w">
                    </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;QueueTimeoutURL&quot;</span><span class="p">,</span><span class="w">
                    </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;https://internalsandbox.safaricom.co.ke/mpesa/abresults/v1/submit&quot;</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>The Account Balance API requests for the account balance of a shortcode.</p>
            
            <h3 id="account-balance-resource-url">Account Balance - Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/accountbalance/v1/query</code></p>
            
            <h3 id="account-balance-request-parameters">Account Balance - Request Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Initiator</td>
                  <td>This is the credential/username used to authenticate the transaction request.</td>
                </tr>
                <tr>
                  <td>SecurityCredential</td>
                  <td>Base64 encoded string of the M-Pesa short code and password, which is encrypted using M-Pesa public key and validates the transaction on M-Pesa Core system.</td>
                </tr>
                <tr>
                  <td>CommandID</td>
                  <td>A unique command passed to the M-Pesa system.</td>
                </tr>
                <tr>
                  <td>PartyB</td>
                  <td>The shortcode of the organisation receiving the transaction.</td>
                </tr>
                <tr>
                  <td>ReceiverIdentifierType</td>
                  <td>Type of the organisation receiving the transaction.</td>
                </tr>
                <tr>
                  <td>Remarks</td>
                  <td>Comments that are sent along with the transaction.</td>
                </tr>
                <tr>
                  <td>QueueTimeOutURL</td>
                  <td>The timeout end-point that receives a timeout message.</td>
                </tr>
                <tr>
                  <td>ResultURL</td>
                  <td>The end-point that receives a successful transaction.</td>
                </tr>
                <tr>
                  <td>AccountType</td>
                  <td>Organisation receiving the funds.</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="transaction-status">Transaction Status</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">TransactionStatusQuery</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionID</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">IdentifierType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">1</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/result_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Occasion</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">TransactionStatusQuery</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionID</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">IdentifierType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">1</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/result_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Occasion</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span> <span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s">&quot;Initiator&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;CommandID&quot;</span><span class="p">:</span><span class="s">&quot;TransactionStatusQuery&quot;</span><span class="p">,</span>
              <span class="s">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyA&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;IdentifierType&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
              <span class="s">&quot;ResultURL&quot;</span><span class="p">:</span><span class="s">&quot;https://ip_address:port/result_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span><span class="s">&quot;https://ip_address:port/timeout_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;Remarks&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Occasion&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span>
            <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;Initiator&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;CommandID&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionStatusQuery&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyA&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;IdentifierType&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;ResultURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://ip_address:port/result_url&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://ip_address:port/timeout_url&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Remarks&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Occasion&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span>
                <span class="p">}</span>
              <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;Initiator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;SecurityCredential&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TransactionStatusQuery&#39;</span><span class="p">,</span>
              <span class="s1">&#39;TransactionID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;IdentifierType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ResultURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/result_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;QueueTimeOutURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/timeout_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Remarks&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Occasion&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:Initiator</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:SecurityCredential</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CommandID</span><span class="w"> </span><span class="s">&quot;TransactionStatusQuery&quot;</span><span class="w">
                  </span><span class="no">:TransactionID</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> 
                  </span><span class="no">:PartyA</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> 
                  </span><span class="no">:IdentifierType</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="w">
                  </span><span class="no">:ResultURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/result_url&quot;</span><span class="w">
                  </span><span class="no">:QueueTimeOutURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/timeout_url&quot;</span><span class="w">
                  </span><span class="no">:Remarks</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Occasion</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
              </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;Initiator\&quot;: \&quot; \&quot;,
              \&quot;SecurityCredential\&quot;: \&quot; \&quot;,
              \&quot;CommandID\&quot;:\&quot;TransactionStatusQuery\&quot;,
              \&quot;TransactionID\&quot;: \&quot; \&quot;,
              \&quot;PartyA\&quot;: \&quot; \&quot;,
              \&quot;IdentifierType\&quot;:\&quot;1\&quot;,
              \&quot;ResultURL\&quot;:\&quot;https://ip_address:port/result_url\&quot;,
              \&quot;QueueTimeOutURL\&quot;:\&quot;https://ip_address:port/timeout_url\&quot;,
              \&quot;Remarks\&quot;: \&quot; \&quot;,
              \&quot;Occasion\&quot;: \&quot; \&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;Result&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;ResultType&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;The service request has been accepted successfully.&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;OriginatorConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;10816-694520-2&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;AG_20170727_000059c52529a8e080bd&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot;LGR0000000&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultParameters&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ResultParameter&quot;</span><span class="p">:[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;ReceiptNo&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;LGR919G2AV&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Conversation ID&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;AG_20170727_00004492b1b6d0078fbe&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;FinalisedTime&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">20170727101415</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Amount&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">10</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionStatus&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Completed&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;ReasonType&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Salary Payment via API&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionReason&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;DebitPartyCharges&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Fee For B2C Payment|KES|33.00&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;DebitAccountType&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;Utility Account&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;InitiatedTime&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">20170727101415</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Originator Conversation ID&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;19455-773836-1&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;CreditPartyName&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;254708374149 - John Doe&quot;</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                      </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;DebitPartyName&quot;</span><span class="p">,</span><span class="w">
                      </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;600134 - Safaricom157&quot;</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                  </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">&quot;ReferenceData&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ReferenceItem&quot;</span><span class="p">:{</span><span class="w">
                    </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;Occasion&quot;</span><span class="p">,</span><span class="w">
                    </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;aaaa&quot;</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>Transaction Status API checks the status of a B2B, B2C and C2B APIs transactions.</p>
            
            <h3 id="transaction-status-resource-url">Transaction Status Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/transactionstatus/v1/query</code></p>
            
            <h3 id="transaction-status-request-parameters">Transaction Status Request Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>CommandID</td>
                  <td>Unique command for each transaction type, possible values are: TransactionStatusQuery.</td>
                </tr>
                <tr>
                  <td>ShortCode</td>
                  <td>Organization /MSISDN sending the transaction.</td>
                </tr>
                <tr>
                  <td>IdentifierType</td>
                  <td>Type of organization receiving the transaction</td>
                </tr>
                <tr>
                  <td>Remarks</td>
                  <td>Comments that are sent along with the transaction.</td>
                </tr>
                <tr>
                  <td>Initiator</td>
                  <td>The name of Initiator to initiating the request.</td>
                </tr>
                <tr>
                  <td>SecurityCredential</td>
                  <td>Base64 encoded string of the M-Pesa short code and password, which is encrypted using M-Pesa public key and validates the transaction on M-Pesa Core system.</td>
                </tr>
                <tr>
                  <td>QueueTimeOutURL</td>
                  <td>The path that stores information of time out transaction.</td>
                </tr>
                <tr>
                  <td>ResultURL</td>
                  <td>The path that stores information of transaction.</td>
                </tr>
                <tr>
                  <td>TransactionID</td>
                  <td>Organization Receiving the funds.</td>
                </tr>
                <tr>
                  <td>Occasion</td>
                  <td>Optional.</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="reversal">Reversal</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">TransactionReversal</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ReceiverParty</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">RecieverIdentifierType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">4</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/result_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Occasion</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">Initiator</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">SecurityCredential</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CommandID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">TransactionReversal</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ReceiverParty</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">RecieverIdentifierType</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">4</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">ResultURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/result_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">QueueTimeOutURL</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/timeout_url</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Remarks</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Occasion</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Initiator&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;CommandID&quot;</span><span class="p">:</span><span class="s">&quot;TransactionReversal&quot;</span><span class="p">,</span>
              <span class="s">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Amount&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;ReceiverParty&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;RecieverIdentifierType&quot;</span><span class="p">:</span><span class="s">&quot;4&quot;</span><span class="p">,</span>
              <span class="s">&quot;ResultURL&quot;</span><span class="p">:</span><span class="s">&quot;https://ip_address:port/result_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span><span class="s">&quot;https://ip_address:port/timeout_url&quot;</span><span class="p">,</span>
              <span class="s">&quot;Remarks&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Occasion&quot;</span><span class="p">:</span><span class="s">&quot; &quot;</span>
              <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                  <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Initiator&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;SecurityCredential&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;CommandID&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionReversal&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Amount&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ReceiverParty&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;RecieverIdentifierType&quot;</span><span class="p">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ResultURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://ip_address:port/result_url&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;QueueTimeOutURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://ip_address:port/timeout_url&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Remarks&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Occasion&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Initiator&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;SecurityCredential&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CommandID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TransactionReversal&#39;</span><span class="p">,</span>
              <span class="s1">&#39;TransactionID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Amount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;ReceiverParty&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;RecieverIdentifierType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ResultURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/result_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;QueueTimeOutURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/timeout_url&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Remarks&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Occasion&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:Initiator</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:SecurityCredential</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CommandID</span><span class="w"> </span><span class="s">&quot;TransactionReversal&quot;</span><span class="w">
                  </span><span class="no">:TransactionID</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Amount</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:ReceiverParty</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:RecieverIdentifierType</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="w">
                  </span><span class="no">:ResultURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/result_url&quot;</span><span class="w">
                  </span><span class="no">:QueueTimeOutURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/timeout_url&quot;</span><span class="w">
                  </span><span class="no">:Remarks</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Occasion</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;Initiator\&quot;:\&quot; \&quot;,
              \&quot;SecurityCredential\&quot;:\&quot; \&quot;,
              \&quot;CommandID\&quot;:\&quot;TransactionReversal\&quot;,
              \&quot;TransactionID\&quot;:\&quot; \&quot;,
              \&quot;Amount\&quot;:\&quot; \&quot;,
              \&quot;ReceiverParty\&quot;:\&quot; \&quot;,
              \&quot;RecieverIdentifierType\&quot;:\&quot;4\&quot;,
              \&quot;ResultURL\&quot;:\&quot;https://ip_address:port/result_url\&quot;,
              \&quot;QueueTimeOutURL\&quot;:\&quot;https://ip_address:port/timeout_url\&quot;,
              \&quot;Remarks\&quot;:\&quot; \&quot;,
              \&quot;Occasion\&quot;:\&quot; \&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;Result&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;ResultType&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;The service request has been accepted successfully.&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;OriginatorConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;10819-695089-1&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ConversationID&quot;</span><span class="p">:</span><span class="s2">&quot;AG_20170727_00004efadacd98a01d15&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;TransactionID&quot;</span><span class="p">:</span><span class="s2">&quot;LGR019G3J2&quot;</span><span class="p">,</span><span class="w">
                </span><span class="s2">&quot;ReferenceData&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;ReferenceItem&quot;</span><span class="p">:{</span><span class="w">
                    </span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;QueueTimeoutURL&quot;</span><span class="p">,</span><span class="w">
                    </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;https://internalsandbox.safaricom.co.ke/mpesa/reversalresults/v1/submit&quot;</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>Reverses a B2B, B2C or C2B M-Pesa transaction.</p>
            
            <h3 id="reversal-resource-url">Reversal Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/reversal/v1/request</code></p>
            
            <h3 id="reversal-request-parameters">Reversal Request Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Initiator</td>
                  <td>This is the credential/username used to authenticate the transaction request.</td>
                </tr>
                <tr>
                  <td>SecurityCredential</td>
                  <td>Base64 encoded string of the M-Pesa short code and password, which is encrypted using M-Pesa public key and validates the transaction on M-Pesa Core system.</td>
                </tr>
                <tr>
                  <td>CommandID</td>
                  <td>Unique command for each transaction type, possible values are: TransactionReversal.</td>
                </tr>
                <tr>
                  <td>PartyA</td>
                  <td>Organization/MSISDN sending the transaction.</td>
                </tr>
                <tr>
                  <td>RecieverIdentifierType</td>
                  <td>Type of organization receiving the transaction.</td>
                </tr>
                <tr>
                  <td>Remarks</td>
                  <td>Comments that are sent along with the transaction.</td>
                </tr>
                <tr>
                  <td>QueueTimeOutURL</td>
                  <td>The path that stores information of time out transaction.</td>
                </tr>
                <tr>
                  <td>ResultURL</td>
                  <td>The path that stores information of transaction.</td>
                </tr>
                <tr>
                  <td>TransactionID</td>
                  <td>Organization Receiving the funds.</td>
                </tr>
                <tr>
                  <td>Occasion</td>
                  <td>Optional.</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="lipa-na-m-pesa-online-payment">Lipa na M-Pesa Online Payment</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">BusinessShortCode</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Password</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Timestamp</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionType</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">CustomerPayBillOnline</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyB</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PhoneNumber</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CallBackURL</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/callback</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">AccountReference</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionDesc</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">BusinessShortCode</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Password</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Timestamp</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionType</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">CustomerPayBillOnline</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Amount</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyA</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PartyB</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">PhoneNumber</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CallBackURL</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">https://ip_address:port/callback</span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">AccountReference</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">TransactionDesc</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span> <span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s">&quot;BusinessShortCode&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Password&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;Timestamp&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;TransactionType&quot;</span><span class="p">:</span> <span class="s">&quot;CustomerPayBillOnline&quot;</span><span class="p">,</span>
              <span class="s">&quot;Amount&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyA&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PartyB&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;PhoneNumber&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;CallBackURL&quot;</span><span class="p">:</span> <span class="s">&quot;https://ip_address:port/callback&quot;</span><span class="p">,</span>
              <span class="s">&quot;AccountReference&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
              <span class="s">&quot;TransactionDesc&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span>
            <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;BusinessShortCode&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Password&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;TransactionType&quot;</span><span class="p">:</span> <span class="s2">&quot;CustomerPayBillOnline&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Amount&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyA&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PartyB&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;PhoneNumber&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;CallBackURL&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ip_address:port/callback&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;AccountReference&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                  <span class="s2">&quot;TransactionDesc&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span>
                <span class="p">}</span>
              <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;BusinessShortCode&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Timestamp&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;TransactionType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CustomerPayBillOnline&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Amount&quot;&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PartyB&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;PhoneNumber&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CallBackURL&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://ip_address:port/callback&#39;</span><span class="p">,</span>
              <span class="s1">&#39;AccountReference&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;TransactionDesc&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:BusinessShortCode</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Password</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Timestamp</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:TransactionType</span><span class="w"> </span><span class="s">&quot;CustomerPayBillOnline&quot;</span><span class="w">
                  </span><span class="no">:Amount</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PartyA</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PartyB</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:PhoneNumber</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> 
                  </span><span class="no">:CallBackURL</span><span class="w"> </span><span class="s">&quot;https://ip_address:port/callback&quot;</span><span class="w">
                  </span><span class="no">:AccountReference</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:TransactionDesc</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;BusinessShortCode\&quot;: \&quot; \&quot;,
              \&quot;Password\&quot;: \&quot; \&quot;,
              \&quot;Timestamp\&quot;: \&quot; \&quot;,
              \&quot;TransactionType\&quot;: \&quot;CustomerPayBillOnline\&quot;,
              \&quot;Amount\&quot;: \&quot; \&quot;,
              \&quot;PartyA\&quot;: \&quot; \&quot;,
              \&quot;PartyB\&quot;: \&quot; \&quot;,
              \&quot;PhoneNumber\&quot;: \&quot; \&quot;,
              \&quot;CallBackURL\&quot;: \&quot;https://ip_address:port/callback\&quot;,
              \&quot;AccountReference\&quot;: \&quot; \&quot;,
              \&quot;TransactionDesc\&quot;: \&quot; \&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="err">//</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">cancelled</span><span class="w"> </span><span class="err">request</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;Body&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;stkCallback&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;MerchantRequestID&quot;</span><span class="p">:</span><span class="s2">&quot;8555-67195-1&quot;</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;CheckoutRequestID&quot;</span><span class="p">:</span><span class="s2">&quot;ws_CO_27072017151044001&quot;</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">1032</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;[STK_CB - ]Request cancelled by user&quot;</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            
            </span><span class="err">//</span><span class="w"> </span><span class="err">An</span><span class="w"> </span><span class="err">accepted</span><span class="w"> </span><span class="err">request</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;Body&quot;</span><span class="p">:{</span><span class="w">
                </span><span class="s2">&quot;stkCallback&quot;</span><span class="p">:{</span><span class="w">
                  </span><span class="s2">&quot;MerchantRequestID&quot;</span><span class="p">:</span><span class="s2">&quot;19465-780693-1&quot;</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;CheckoutRequestID&quot;</span><span class="p">:</span><span class="s2">&quot;ws_CO_27072017154747416&quot;</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;The service request is processed successfully.&quot;</span><span class="p">,</span><span class="w">
                  </span><span class="s2">&quot;CallbackMetadata&quot;</span><span class="p">:{</span><span class="w">
                    </span><span class="s2">&quot;Item&quot;</span><span class="p">:[</span><span class="w">
                      </span><span class="p">{</span><span class="w">
                        </span><span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Amount&quot;</span><span class="p">,</span><span class="w">
                        </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">1</span><span class="w">
                      </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w">
                        </span><span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;MpesaReceiptNumber&quot;</span><span class="p">,</span><span class="w">
                        </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="s2">&quot;LGR7OWQX0R&quot;</span><span class="w">
                      </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w">
                        </span><span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Balance&quot;</span><span class="w">
                      </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w">
                        </span><span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;TransactionDate&quot;</span><span class="p">,</span><span class="w">
                        </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">20170727154800</span><span class="w">
                      </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w">
                        </span><span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;PhoneNumber&quot;</span><span class="p">,</span><span class="w">
                        </span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="mi">254721566839</span><span class="w">
                      </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <p>Lipa na M-Pesa Online Payment API is used to initiate a M-Pesa transaction on behalf of a customer using STK Push. This is the same technique mySafaricom App uses whenever the app is used to make payments.</p>
            
            <h3 id="lipa-na-m-pesa-online-payment-resource-url">Lipa na M-Pesa Online Payment - Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest</code></p>
            
            <h3 id="lipa-na-m-pesa-online-payment-request-parameters">Lipa na M-Pesa Online Payment - Request Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>BusinessShortCode</td>
                  <td>The organization shortcode used to receive the transaction.</td>
                </tr>
                <tr>
                  <td>Password</td>
                  <td>The password for encrypting the request. This is generated by base64 encoding <code class="prettyprint">BusinessShortcode</code>, <code class="prettyprint">Passkey</code> and <code class="prettyprint">Timestamp</code>.</td>
                </tr>
                <tr>
                  <td>Timestamp</td>
                  <td>The timestamp of the transaction in the format <code class="prettyprint">yyyymmddhhiiss</code>.</td>
                </tr>
                <tr>
                  <td>TransactionType</td>
                  <td>The transaction type to be used for this request. Only <code class="prettyprint">CustomerPayBillOnline</code> is supported.</td>
                </tr>
                <tr>
                  <td>Amount</td>
                  <td>The amount to be transacted.</td>
                </tr>
                <tr>
                  <td>PartyA</td>
                  <td>The MSISDN sending the funds.</td>
                </tr>
                <tr>
                  <td>PartyB</td>
                  <td>The organization shortcode receiving the funds</td>
                </tr>
                <tr>
                  <td>PhoneNumber</td>
                  <td>The MSISDN sending the funds.</td>
                </tr>
                <tr>
                  <td>CallBackURL</td>
                  <td>The url to where responses from M-Pesa will be sent to.</td>
                </tr>
                <tr>
                  <td>AccountReference</td>
                  <td>Used with M-Pesa PayBills.</td>
                </tr>
                <tr>
                  <td>TransactionDesc</td>
                  <td>A description of the transaction.</td>
                </tr>
              </tbody>
            </table>
            
            <h3 id="lipa-na-m-pesa-online-payment-response-parameters">Lipa na M-Pesa Online Payment - Response Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>MerchantRequestID</td>
                  <td>Merchant Request ID</td>
                </tr>
                <tr>
                  <td>CheckoutRequestID</td>
                  <td>Check out Request ID</td>
                </tr>
                <tr>
                  <td>ResponseCode</td>
                  <td>Response Code</td>
                </tr>
                <tr>
                  <td>ResultDesc</td>
                  <td>Result Desc</td>
                </tr>
                <tr>
                  <td>ResponseDescription</td>
                  <td>Response Description message</td>
                </tr>
                <tr>
                  <td>ResultCode</td>
                  <td>Result Code</td>
                </tr>
              </tbody>
            </table>
            
            <h2 id="lipa-na-m-pesa-online-query-request">Lipa na M-Pesa Online Query Request</h2>
            
            <pre class="highlight shell tab-shell">
            <code>curl -X POST --header <span class="s2">&quot;Authorization: Bearer &lt;Access-Token&gt;&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s2">&quot;{
              </span><span class="se">\&quot;</span><span class="s2">BusinessShortCode</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2"> ,
              </span><span class="se">\&quot;</span><span class="s2">Password</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">Timestamp</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
              </span><span class="se">\&quot;</span><span class="s2">CheckoutRequestID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">
            }&quot;</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&quot;</span>
            
            </code></pre>
            
            <pre class="highlight ruby tab-ruby">
            <code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;net/https&#39;</span>
            <span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
            
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&#39;</span><span class="p">)</span>
            
            <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
            <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
            
            <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &lt;Access-Token&gt;&#39;</span>
            <span class="n">request</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">BusinessShortCode</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2"> ,
                    </span><span class="se">\&quot;</span><span class="s2">Password</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                    </span><span class="se">\&quot;</span><span class="s2">Timestamp</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">,
                    </span><span class="se">\&quot;</span><span class="s2">CheckoutRequestID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span>
            </code></pre>
            
            <pre class="highlight python tab-python">
            <code><span class="kn">import</span> <span class="nn">requests</span>
            
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="s">&quot;Access-Token&quot;</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s">&quot;Bearer </span><span class="si">%</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">}</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;BusinessShortCode&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span> <span class="p">,</span>
                    <span class="s">&quot;Password&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
                    <span class="s">&quot;Timestamp&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
                    <span class="s">&quot;CheckoutRequestID&quot;</span><span class="p">:</span> <span class="s">&quot; &quot;</span>
              <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            
            <span class="k">print</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
              <span class="nx">oauth_token</span> <span class="o">=</span> <span class="s2">&quot;ACCESS_TOKEN&quot;</span><span class="p">,</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&quot;</span>
              <span class="nx">auth</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nx">oauth_token</span><span class="p">;</span>
            
              <span class="nx">request</span><span class="p">(</span>
                <span class="p">{</span>
                  <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
                  <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                  <span class="na">headers</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span> <span class="p">:</span> <span class="nx">auth</span>
                  <span class="p">},</span>
                  <span class="na">json</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;BusinessShortCode&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span> <span class="p">,</span>
                    <span class="s2">&quot;Password&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="s2">&quot;CheckoutRequestID&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// TODO: Use the body object to extract the response</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="p">}</span>
              <span class="p">)</span>
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&#39;</span><span class="p">;</span>
            
            <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type:application/json&#39;</span><span class="p">,</span><span class="s1">&#39;Authorization:Bearer ACCESS_TOKEN&#39;</span><span class="p">));</span> <span class="c1">//setting custom header
            </span>
            
            <span class="nv">$curl_post_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="c1">//Fill in the request parameters with valid values
            </span>  <span class="s1">&#39;BusinessShortCode&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;Timestamp&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
              <span class="s1">&#39;CheckoutRequestID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span>
            <span class="p">);</span>
            
            <span class="nv">$data_string</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$curl_post_data</span><span class="p">);</span>
            
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data_string</span><span class="p">);</span>
            
            <span class="nv">$curl_response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$curl_response</span><span class="p">);</span>
            
            <span class="k">echo</span> <span class="nv">$curl_response</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight clojure tab-clojure">
            <code><span class="p">(</span><span class="k">let</span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">body</span><span class="p">]}</span><span class="w"> 
              </span><span class="p">(</span><span class="nf">clj-http.client/post</span><span class="w"> </span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&quot;</span><span class="p">{</span><span class="w">
                </span><span class="no">:headers</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Content-Type&quot;</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">}</span><span class="w">
                </span><span class="no">:oauth-token</span><span class="w"> </span><span class="s">&quot;ACCESS_TOKEN&quot;</span><span class="w">
                </span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.data.json/write-str</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="no">:BusinessShortCode</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> 
                  </span><span class="no">:Password</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:Timestamp</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="no">:CheckoutRequestID</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">
                  </span><span class="p">})</span><span class="w">
                </span><span class="p">})</span><span class="w">
              </span><span class="p">]</span><span class="w">
              </span><span class="p">(</span><span class="nf">json/read-str</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="no">:key-fn</span><span class="w"> </span><span class="nb">keyword</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span></code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
            
            <span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
            <span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">&quot;{\&quot;BusinessShortCode\&quot;:\&quot; \&quot; ,
                    \&quot;Password\&quot;:\&quot; \&quot;,
                    \&quot;Timestamp\&quot;:\&quot; \&quot;,
                    \&quot;CheckoutRequestID\&quot;:\&quot; \&quot;}&quot;</span><span class="o">);</span>
            <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">&quot;https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Bearer ACCESS_TOKEN&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;content-type&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            
            <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            </code></pre>
            
            <pre class="highlight json tab-json">
            <code><span class="p">{</span><span class="w">
              </span><span class="s2">&quot;ResponseCode&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;ResponseDescription&quot;</span><span class="p">:</span><span class="s2">&quot;The service request has been accepted successfully&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;MerchantRequestID&quot;</span><span class="p">:</span><span class="s2">&quot;8555-67195-1&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;CheckoutRequestID&quot;</span><span class="p">:</span><span class="s2">&quot;ws_CO_27072017151044001&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span><span class="s2">&quot;1032&quot;</span><span class="p">,</span><span class="w">
              </span><span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span><span class="s2">&quot;[STK_CB - ]Request cancelled by user&quot;</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span></code></pre>
            
            <h3 id="lipa-na-m-pesa-online-query-request-resource-url">Lipa na M-Pesa Online Query Request - Resource URL</h3>
            
            <p><code class="prettyprint">POST https://sandbox.safaricom.co.ke/mpesa/stkpushquery/v1/query</code></p>
            
            <h3 id="lipa-na-m-pesa-online-query-request-request-parameters">Lipa na M-Pesa Online Query Request - Request Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>BusinessShortCode</td>
                  <td>Business Short Code</td>
                </tr>
                <tr>
                  <td>Password</td>
                  <td>Password</td>
                </tr>
                <tr>
                  <td>Timestamp</td>
                  <td>Timestamp</td>
                </tr>
                <tr>
                  <td>CheckoutRequestID</td>
                  <td>Checkout RequestID</td>
                </tr>
              </tbody>
            </table>
            
            <h3 id="lipa-na-m-pesa-online-query-request-response-parameters">Lipa na M-Pesa Online Query Request - Response Parameters</h3>
            
            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>MerchantRequestID</td>
                  <td>Merchant Request ID</td>
                </tr>
                <tr>
                  <td>CheckoutRequestID</td>
                  <td>Check out Request ID</td>
                </tr>
                <tr>
                  <td>ResponseCode</td>
                  <td>Response Code</td>
                </tr>
                <tr>
                  <td>ResultDesc</td>
                  <td>Result Desc</td>
                </tr>
                <tr>
                  <td>ResponseDescription</td>
                  <td>Response Description message</td>
                </tr>
                <tr>
                  <td>ResultCode</td>
                  <td>Result Code</td>
                </tr>
              </tbody>
            </table>
            
            <h1 id="errors">Errors</h1>
            
            <p>Safaricom APIs are built to comply with HTTP Status codes. The following are error codes that will be returned whenever there are errors in a request. Server errors are rare but do occur whenever there are connectivity issues.</p>
            
            <table>
              <thead>
                <tr>
                  <th>Error Code</th>
                  <th>Meaning</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>400</td>
                  <td>Bad Request</td>
                </tr>
                <tr>
                  <td>401</td>
                  <td>Unauthorized</td>
                </tr>
                <tr>
                  <td>403</td>
                  <td>Forbidden</td>
                </tr>
                <tr>
                  <td>404</td>
                  <td>Not Found</td>
                </tr>
                <tr>
                  <td>405</td>
                  <td>Method Not Allowed</td>
                </tr>
                <tr>
                  <td>406</td>
                  <td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
                </tr>
                <tr>
                  <td>429</td>
                  <td>Too Many Requests</td>
                </tr>
                <tr>
                  <td>500</td>
                  <td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
                </tr>
                <tr>
                  <td>503</td>
                  <td>Service Unavailable &ndash; We&rsquo;re temporarily offline for maintenance. Please try again later.</td>
                </tr>
              </tbody>
            </table>
            
            <h1 id="creating-a-http-server-listener">Creating a HTTP Server Listener</h1>
            
            <pre class="highlight python tab-python">
            <code><span class="c"># import the Flask Framework</span>
            <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">jsonify</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">request</span>
            
            <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            
            <span class="c"># Create the context (endpoint/URL) which will be triggered when the request</span>
            <span class="c"># hits the above specified port. This will resolve to a URL like</span>
            <span class="c"># &#39;http://address:port/context&#39;. E.g. the context below would</span>
            <span class="c"># resolve to &#39;http://127.0.0.1:80/mpesa/b2c/v1&#39; on the local computer. Then</span>
            <span class="c"># the Handler will handle the request received via the given URL.</span>
            
            <span class="c"># You may create a separate URL for every endpoint you need</span>
            
            <span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/mpesa/b2c/v1&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;POST&quot;</span><span class="p">])</span>
            <span class="k">def</span> <span class="nf">listenB2c</span><span class="p">():</span>
                <span class="c">#save the data</span>
                <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
            
                <span class="c">#Perform your processing here e.g. print it out...</span>
                <span class="k">print</span><span class="p">(</span><span class="n">request_data</span><span class="p">)</span>
            
                <span class="c"># Prepare the response, assuming no errors have occurred. Any response</span>
                <span class="c"># other than a 0 (zero) for the &#39;ResultCode&#39; during Validation only means</span>
                <span class="c"># an error occurred and the transaction is cancelled</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&quot;ResultCode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">&quot;ResultDesc&quot;</span><span class="p">:</span> <span class="s">&quot;The service was accepted successfully&quot;</span><span class="p">,</span>
                    <span class="s">&quot;ThirdPartyTransID&quot;</span><span class="p">:</span> <span class="s">&quot;1234567890&quot;</span>
                <span class="p">};</span>
            
                <span class="c"># Send the response back to the server</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}),</span> <span class="mi">200</span>
            
            <span class="c"># Change this part to reflect the API you are testing</span>
            <span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/mpesa/b2b/v1&#39;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">listenB2b</span><span class="p">():</span>
                <span class="n">request_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
                <span class="k">print</span><span class="p">(</span><span class="n">request_data</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&quot;ResultCode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">&quot;ResultDesc&quot;</span><span class="p">:</span> <span class="s">&quot;The service was accepted successfully&quot;</span><span class="p">,</span>
                    <span class="s">&quot;ThirdPartyTransID&quot;</span><span class="p">:</span> <span class="s">&quot;1234567890&quot;</span>
                <span class="p">};</span>
            
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}),</span> <span class="mi">200</span>
            
            <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
                <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
            </code></pre>
            
            <pre class="highlight javascript tab-javascript">
            <code><span class="kd">var</span> <span class="nx">prettyjson</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;prettyjson&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
              <span class="na">noColor</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">};</span>
            
            <span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">),</span>
                <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">),</span>
                <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
            
            <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
            
            <span class="c1">// B2C ResultURL - /api/v1/b2c/result</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/b2c/result&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------B2C CALLBACK------------&#39;</span><span class="p">);</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prettyjson</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------------&#39;</span><span class="p">);</span>
            
              <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ResponseCode&quot;</span><span class="p">:</span> <span class="s2">&quot;00000000&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ResponseDesc&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
              <span class="p">};</span>
            
              <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">});</span>
            
            <span class="c1">// B2C QueueTimeoutURL - /api/v1/b2c/timeout</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/b2c/timeout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------B2C TIMEOUT------------&#39;</span><span class="p">);</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prettyjson</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------------&#39;</span><span class="p">);</span>
            
              <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ResponseCode&quot;</span><span class="p">:</span> <span class="s2">&quot;00000000&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ResponseDesc&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
              <span class="p">};</span>
            
              <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">});</span>
            
            <span class="c1">// C2B ValidationURL - /api/v1/c2b/validation</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/validation&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------C2B VALIDATION REQUEST-----------&#39;</span><span class="p">);</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prettyjson</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------------&#39;</span><span class="p">);</span>
            
              <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span> <span class="s2">&quot;Success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ThirdPartyTransID&quot;</span><span class="p">:</span> <span class="s2">&quot;1234567890&quot;</span>
              <span class="p">};</span>
            
              <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">});</span>
            
            <span class="c1">// C2B ConfirmationURL - /api/v1/c2b/confirmation</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/confirmation&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------C2B CONFIRMATION REQUEST------------&#39;</span><span class="p">);</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prettyjson</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------------&#39;</span><span class="p">);</span>
            
              <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ResultCode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;ResultDesc&quot;</span><span class="p">:</span> <span class="s2">&quot;Success&quot;</span>
              <span class="p">};</span>
            
              <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">});</span>
            
            <span class="c1">// B2B ResultURL - /api/v1/b2b/result</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/b2b/result&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------B2B CALLBACK------------&#39;</span><span class="p">);</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prettyjson</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------------&#39;</span><span class="p">);</span>
            
              <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ResponseCode&quot;</span><span class="p">:</span> <span class="s2">&quot;00000000&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ResponseDesc&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
              <span class="p">};</span>
            
              <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">});</span>
            
            
            <span class="c1">// B2B QueueTimeoutURL - /api/v1/b2b/timeout</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/b2b/timeout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------B2B TIMEOUT------------&#39;</span><span class="p">);</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prettyjson</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">));</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------------&#39;</span><span class="p">);</span>
            
              <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ResponseCode&quot;</span><span class="p">:</span> <span class="s2">&quot;00000000&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ResponseDesc&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
              <span class="p">};</span>
            
              <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">});</span>
            
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Server listening on port: 8310&quot;</span><span class="p">)</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8310</span><span class="p">);</span>
            
            </code></pre>
            
            <pre class="highlight php tab-php">
            <code><span class="cp">&lt;?php</span>
            
            
                <span class="nv">$postData</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;php://input&#39;</span><span class="p">);</span>
                <span class="c1">//perform your processing here, e.g. log to file....
            </span>    <span class="nv">$file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;log.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span> <span class="c1">//url fopen should be allowed for this to occur
            </span>    <span class="k">if</span><span class="p">(</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$postData</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="nb">fwrite</span><span class="p">(</span><span class="s2">&quot;Error: no data written&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            
                <span class="nb">fwrite</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">);</span>
                <span class="nb">fclose</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
            
                <span class="k">echo</span> <span class="s1">&#39;{&quot;ResultCode&quot;: 0, &quot;ResultDesc&quot;: &quot;The service was accepted successfully&quot;, &quot;ThirdPartyTransID&quot;: &quot;1234567890&quot;}&#39;</span><span class="p">;</span>
            <span class="cp">?&gt;</span>
            </code></pre>
            
            <pre class="highlight java tab-java">
            <code><span class="c1">//Requires the following libraries. Maven repositories given below</span>
            <span class="kn">import</span> <span class="nn">com.sun.net.httpserver.HttpExchange</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">com.sun.net.httpserver.HttpHandler</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">com.sun.net.httpserver.HttpServer</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">java.net.InetSocketAddress</span><span class="o">;</span>
            <span class="kn">import</span> <span class="nn">org.json.simple.JSONObject</span><span class="o">;</span>
            
            <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span><span class="o">{</span>
                <span class="kd">private</span> <span class="n">HttpServer</span> <span class="n">server</span><span class="o">;</span>
                <span class="kd">public</span> <span class="nf">Main</span><span class="o">()</span>    <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="c1">//Define the port over which the listener will accept requests</span>
                        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span><span class="o">;</span>
            
                        <span class="n">server</span> <span class="o">=</span> <span class="n">HttpServer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="n">port</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span>
                        <span class="cm">/**
                         * Create the context (endpoint/URL) which will be triggered when the request
                         * hits the above specified port. This will resolve to a URL like
                         * &#39;http://address:port/context&#39;. E.g. the context below would
                         * resolve to &#39;http://127.0.0.1:80/confirm&#39; on the local computer. Then
                         * the Handler will handle the request received via the given URL.
                         *
                         * You may create a separate context for every endpoint you need
                        */</span>
                        <span class="n">server</span><span class="o">.</span><span class="na">createContext</span><span class="o">(</span><span class="s">&quot;/confirm&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">ConfirmHandler</span><span class="o">());</span>
            
                        <span class="n">server</span><span class="o">.</span><span class="na">setExecutor</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
            
                        <span class="c1">//start the server</span>
                        <span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Server started&quot;</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">){</span>
                        <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            
                <span class="cm">/**
                 * Class to handle incoming requests based on specified Contexts, you can
                 * create a class for each separate context/URL
                 */</span>
                <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfirmHandler</span> <span class="kd">implements</span> <span class="n">HttpHandler</span><span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">HttpExchange</span> <span class="n">he</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                        <span class="cm">/**
                         * handle the request which comes through the &#39;/confirm&#39; context
                         */</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Request received&quot;</span><span class="o">);</span>
            
                        <span class="cm">/**
                         * Buffer and store the response in a string
                         */</span>
                        <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">he</span><span class="o">.</span><span class="na">getRequestBody</span><span class="o">(),</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">));</span>
                        <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
                        <span class="n">StringBuilder</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
                        <span class="k">while</span><span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                        <span class="o">{</span>
                            <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
                        <span class="o">}</span>
            
                        <span class="cm">/**
                         * Once buffered, you can perform any other processing
                         * you need on the buffered response e.g. print out the response...
                         */</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Res: &quot;</span> <span class="o">+</span> <span class="n">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            
                        <span class="cm">/**
                         * Prepare the response, assuming no errors have occurred. Any response
                         * other than a 0 (zero) for the &#39;ResultCode&#39; during Validation means an
                         * error occurred and the transaction is cancelled
                         */</span>
                        <span class="n">JSONObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
                        <span class="n">obj</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ResultCode&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                        <span class="n">obj</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ResultDesc&quot;</span><span class="o">,</span> <span class="s">&quot;The service was accepted successfully&quot;</span><span class="o">);</span>
                        <span class="n">obj</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ThirdPartyTransID&quot;</span><span class="o">,</span> <span class="s">&quot;1234567890&quot;</span><span class="o">);</span>
            
                        <span class="cm">/**
                         * Respond to the server appropriately
                         */</span>
                        <span class="n">String</span> <span class="n">res</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">toJSONString</span><span class="o">();</span>
                        <span class="n">he</span><span class="o">.</span><span class="na">sendResponseHeaders</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">res</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
                        <span class="n">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="na">getResponseBody</span><span class="o">();</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&quot;UTF-8&quot;</span><span class="o">));</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            
                <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]){</span>
                    <span class="n">Main</span> <span class="n">main</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Main</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
            
            <span class="cm">/**
             * Maven Repositories:
             *
             * &lt;dependency&gt;
             * &lt;groupId&gt;com.sun.net.httpserver&lt;/groupId&gt;
             * &lt;artifactId&gt;http&lt;/artifactId&gt;
             * &lt;version&gt;20070405&lt;/version&gt;
             * &lt;/dependency&gt;
             *
             * &lt;dependency&gt;
             * &lt;groupId&gt;com.googlecode.json-simple&lt;/groupId&gt;
             * &lt;artifactId&gt;json-simple&lt;/artifactId&gt;
             * &lt;version&gt;1.1.1&lt;/version&gt;
             * &lt;/dependency&gt;
             *
             * &lt;repositories&gt;
             * &lt;repository&gt;
             * &lt;id&gt;reficio&lt;/id&gt;
             * &lt;url&gt;http://repo.reficio.org/maven/&lt;/url&gt;
             * &lt;/repository&gt;
             * &lt;/repositories&gt;
             *
             * More examples here: https://www.codeproject.com/Tips/1040097/Create-a-Simple-Web-Server-in-Java-HTTP-Server
             */</span>
            <span class="o">}</span>
            </code></pre>
            
            <p>M-Pesa APIs are asynchronous. When a valid M-Pesa API request is received by the API Gateway, it is sent to M-Pesa where it is added to a queue. M-Pesa then processes the requests in the queue and sends a response to the API Gateway which then forwards the response to the URL registered in the <code class="prettyprint">CallBackURL</code> or <code class="prettyprint">ResultURL</code> request parameter. Whenever M-Pesa receives more requests than the queue can handle, M-Pesa responds by rejecting any more requests and the API Gateway sends a queue timeout response to the URL registered in the <code class="prettyprint">QueueTimeOutURL</code> request parameter.</p>
            
            <p>To receive responses, either M-Pesa results or queue timeouts, an HTTP listener will be needed. The listener should be deployed to a server that can receive traffic over the internet. On local host, use an http tunnelling client like <a href="https://ngrok.com/">ngrok</a> or <a href="https://localtunnel.github.io/www/">localtunnel</a> to get a public IP that will enable your local host to receive traffic over the internet. Sample json responses that are received on callback urls or queue timeout urls are provided in the &lsquo;Json Response&rsquo; tab on the top right corner for each API. Sample http listeners are also provided on the right in Python, NodeJS, PHP and Java.</p>
            
            <aside class="notice">The API Gateway does not cache responses from M-Pesa, should the server running the HTTP listener be unavailable or inaccessible,the API Gateway will log a 503 error and discard the M-Pesa results.</aside>
            
            <p>The HTTP listner should deploy <code class="prettyprint">POST</code> methods for receiving M-Pesa responses on <code class="prettyprint">CallBackURL</code> or <code class="prettyprint">ResultURL</code> and for receiving queue timeouts on <code class="prettyprint">QueueTimeOutURL</code>.</p>
            
            <h1 id="testing-on-local-host">Testing on local host</h1>
            
            <p>To test on local host, an http tunnelling client will be required to the http listner on your local host to make the services running their accessible over the internet.</p>
            
            <p><a href="https://ngrok.com/">Ngrok</a> and <a href="https://localtunnel.github.io/www/">LocalTunnel</a> are examples of http tunnelling clients that you could use to get a public IP and make your local host accessible over the internet.</p>
            </div>
            
            <div class="dark-box">
            <div class="lang-selector"><a data-language-name="shell" href="#">cUrl</a><a data-language-name="ruby" href="#">Ruby</a><a data-language-name="python" href="#">Python</a><a data-language-name="javascript" href="#">Node JS</a><a data-language-name="php" href="#">PHP</a><a data-language-name="clojure" href="#">Clojure</a><a data-language-name="java" href="#">Java</a><a data-language-name="json" href="#">Json Response</a></div>
            </div>
            </div>   
</body>
</html>